<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기 - Kahlua</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Kahlua"><meta name="msapplication-TileImage" content="/img/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Kahlua"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="LangChain의 RunnableWithMessage는 LangChain에서 제공하는 유틸리티 클래스로, 주로 챗봇 애플리케이션 개발 시 이전의 대화 히스토리와 상호작용을 관리하기 위해 사용된다.이 클래스는 주로 대화 기록을 저장하고 관리하여 대화 흐름을 유지하거나 개인화된 응답을 생성하는데 유용하다. 기본적으로 RunnableWithHistory 클래스"><meta property="og:type" content="blog"><meta property="og:title" content="LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기"><meta property="og:url" content="https://hamin7.github.io/2024/11/03/LangChain-RunnableWithMessage/"><meta property="og:site_name" content="Kahlua"><meta property="og:description" content="LangChain의 RunnableWithMessage는 LangChain에서 제공하는 유틸리티 클래스로, 주로 챗봇 애플리케이션 개발 시 이전의 대화 히스토리와 상호작용을 관리하기 위해 사용된다.이 클래스는 주로 대화 기록을 저장하고 관리하여 대화 흐름을 유지하거나 개인화된 응답을 생성하는데 유용하다. 기본적으로 RunnableWithHistory 클래스"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hamin7.github.io/gallery/langChain.png"><meta property="article:published_time" content="2024-11-03T13:37:01.000Z"><meta property="article:modified_time" content="2025-01-21T07:17:07.602Z"><meta property="article:author" content="hamin"><meta property="article:tag" content="LangChain"><meta property="article:tag" content="LLM"><meta property="article:tag" content="Redis"><meta property="article:tag" content="LLM,LangChain"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hamin7.github.io/gallery/langChain.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hamin7.github.io/2024/11/03/LangChain-RunnableWithMessage/"},"headline":"LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기","image":["https://hamin7.github.io/gallery/langChain.png"],"datePublished":"2024-11-03T13:37:01.000Z","dateModified":"2025-01-21T07:17:07.602Z","author":{"@type":"Person","name":"hamin"},"publisher":{"@type":"Organization","name":"Kahlua","logo":{"@type":"ImageObject","url":"https://hamin7.github.io/img/avatar.png"}},"description":"LangChain의 RunnableWithMessage는 LangChain에서 제공하는 유틸리티 클래스로, 주로 챗봇 애플리케이션 개발 시 이전의 대화 히스토리와 상호작용을 관리하기 위해 사용된다.이 클래스는 주로 대화 기록을 저장하고 관리하여 대화 흐름을 유지하거나 개인화된 응답을 생성하는데 유용하다. 기본적으로 RunnableWithHistory 클래스"}</script><link rel="canonical" href="https://hamin7.github.io/2024/11/03/LangChain-RunnableWithMessage/"><link rel="icon" href="/img/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar.png" alt="Kahlua" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/gallery/langChain.png" alt="LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-11-03T13:37:01.000Z" title="11/3/2024, 10:37:01 PM">2024-11-03</time></span><span class="level-item">Updated&nbsp;<time dateTime="2025-01-21T07:17:07.602Z" title="1/21/2025, 4:17:07 PM">2025-01-21</time></span><span class="level-item">3 hours read (About 25279 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기</h1><div class="content"><p>LangChain의 RunnableWithMessage는 LangChain에서 제공하는 유틸리티 클래스로, 주로 챗봇 애플리케이션 개발 시 이전의 대화 히스토리와 상호작용을 관리하기 위해 사용된다.<br>이 클래스는 주로 대화 기록을 저장하고 관리하여 대화 흐름을 유지하거나 개인화된 응답을 생성하는데 유용하다.</p>
<p>기본적으로 RunnableWithHistory 클래스는 대화 세션 내에서 사용자와 AI간의 대화 히스토리를 지속적으로 기록할 수 있도록 해주며, 필요한 경우 특정 조건에 따라 히스토리를 요약하거나 일부 삭제할 수 있는 기능도 제공한다.<br>이를통해 챗봇이 각 세션마다 대화 컨텍스트를 유지할 수 있어 더욱 자연스러운 대화 경험을 제공한다.</p>
<span id="more"></span>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv(dotenv_path=<span class="string">&quot;../.env&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span><br><span class="line"><span class="comment"># !pip install langchain-teddynote</span></span><br><span class="line"><span class="keyword">from</span> langchain_teddynote <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프로젝트 이름을 입력합니다.</span></span><br><span class="line">logging.langsmith(<span class="string">&quot;langchain-Memory&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span><br><span class="line"><span class="comment"># !pip install langchain-teddynote</span></span><br><span class="line"><span class="keyword">from</span> langchain_teddynote <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프로젝트 이름을 입력합니다.</span></span><br><span class="line">logging.langsmith(<span class="string">&quot;langchain-Memory&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">model = ChatOpenAI()</span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;당신은 &#123;ability&#125; 에 능숙한 어시스턴트입니다. 20자 이내로 응답하세요&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment"># 대화 기록을 변수로 사용, history 가 MessageHistory 의 key 가 됨</span></span><br><span class="line">        MessagesPlaceholder(variable_name=<span class="string">&quot;history&quot;</span>),</span><br><span class="line">        (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;input&#125;&quot;</span>),  <span class="comment"># 사용자 입력을 변수로 사용</span></span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">runnable = prompt | model  <span class="comment"># 프롬프트와 모델을 연결하여 runnable 객체 생성</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.chat_history <span class="keyword">import</span> BaseChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables.history <span class="keyword">import</span> RunnableWithMessageHistory</span><br><span class="line"></span><br><span class="line">store = &#123;&#125;  <span class="comment"># 세션 기록을 저장할 딕셔너리</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 세션 ID를 기반으로 세션 기록을 가져오는 함수</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">session_ids: <span class="built_in">str</span></span>) -&gt; BaseChatMessageHistory:</span><br><span class="line">    <span class="built_in">print</span>(session_ids)</span><br><span class="line">    <span class="keyword">if</span> session_ids <span class="keyword">not</span> <span class="keyword">in</span> store:  <span class="comment"># 세션 ID가 store에 없는 경우</span></span><br><span class="line">        <span class="comment"># 새로운 ChatMessageHistory 객체를 생성하여 store에 저장</span></span><br><span class="line">        store[session_ids] = ChatMessageHistory()</span><br><span class="line">    <span class="keyword">return</span> store[session_ids]  <span class="comment"># 해당 세션 ID에 대한 세션 기록 반환</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with_message_history = (</span><br><span class="line">    RunnableWithMessageHistory(  <span class="comment"># RunnableWithMessageHistory 객체 생성</span></span><br><span class="line">        runnable,  <span class="comment"># 실행할 Runnable 객체</span></span><br><span class="line">        get_session_history,  <span class="comment"># 세션 기록을 가져오는 함수</span></span><br><span class="line">        input_messages_key=<span class="string">&quot;input&quot;</span>,  <span class="comment"># 입력 메시지의 키</span></span><br><span class="line">        history_messages_key=<span class="string">&quot;history&quot;</span>,  <span class="comment"># 기록 메시지의 키</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="영구-저장소-Persistent-Storage"><a href="#영구-저장소-Persistent-Storage" class="headerlink" title="영구 저장소 (Persistent Storage)"></a>영구 저장소 (Persistent Storage)</h1><p>영구 저장소(Persistent Storage)는 프로그램이 종료되거나 시스템이 재부팅되더라도 데이터를 유지하는 저장 메커니즘을 말한다.<br>이는 데이터베이스, 파일시스템, 또는 기타 비휘발성 저장 장치를 통해 구현될 수 있다.</p>
<p>영구 저장소는 애플리케이션의 상태를 저장하고, 사용자 설정을 유지하며, 장기간 데이터를 보존하는 데 필수적이다.<br>이를 통해 프로그램은 이전 실행에서 중단된 지점부터 다시 시작할 수 있으며, 사용자는 데이터 손실 없이 작업을 계속 할 수 있다.</p>
<ul>
<li>RunnableWithMessageHistory는 get_session_history 호출 가능 객체가 채팅 메시지 기록을 어떻게 검색하는지에 대해 독립적이다.</li>
</ul>
<h2 id="Redis-설치"><a href="#Redis-설치" class="headerlink" title="Redis 설치"></a>Redis 설치</h2><p>Redis가 설치되어 있지 않다면 먼저 설치해야 한다.</p>
<p>폐쇄망 EC2이기 때문에, 인터넷이 연결된 로컬 컴퓨터에서 EC2 서버에 설치할 패키지를 다운로드 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">% </span><span class="language-bash">pip download redis</span></span><br><span class="line">Collecting redis</span><br><span class="line">  Using cached redis-5.2.0-py3-none-any.whl.metadata (9.1 kB)</span><br><span class="line">Using cached redis-5.2.0-py3-none-any.whl (261 kB)</span><br><span class="line">Saved ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">Successfully downloaded redis</span><br></pre></td></tr></table></figure>

<p>S3에 redis whl 파일을 업로드한다.<br>그리고 EC2에 S3에서 whl 파일을 가져온다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws configure</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> AWS_ACCESS_KEY_ID=...</span></span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws s3 <span class="built_in">cp</span> s3://aipin-bucket/redis-5.2.0-py3-none-any.whl /root</span></span><br><span class="line">download: s3://aipin-bucket/redis-5.2.0-py3-none-any.whl to ./redis-5.2.0-py3-none-any.whl</span><br></pre></td></tr></table></figure>

<p>다운로드한 파일들을 EC2에서 설치한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install redis-5.2.0-py3-none-any.whl --no-index --find-links .</span></span><br><span class="line">WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.</span><br><span class="line">Looking in links: .</span><br><span class="line">Processing ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">ERROR: Package &#x27;redis&#x27; requires a different Python: 3.7.16 not in &#x27;&gt;=3.8&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>–no-index 옵션을 사용하여 외부 PyPI에 접속하지 않고, 지정된 디렉토리(–find-links .)에서만 패키지를 찾도록 한다.</li>
<li>redis 패키지가 Python3.8 이상의 버전을 요구하고 현재 시스템에 설치된 Python 버전이 3.7.16이기 때문에, Python 3.8이상으로 업그레이드 해야한다.</li>
</ul>
<h2 id="Python-버전-업그레이드-방법-Amazon-Linux-환경"><a href="#Python-버전-업그레이드-방법-Amazon-Linux-환경" class="headerlink" title="Python 버전 업그레이드 방법 (Amazon Linux 환경)"></a>Python 버전 업그레이드 방법 (Amazon Linux 환경)</h2><ol>
<li>Python 3.8 설치<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y amazon-linux-extras</span><br><span class="line">sudo amazon-linux-extras enable python3.8</span><br><span class="line">sudo yum install -y python3.8</span><br></pre></td></tr></table></figure></li>
<li>기본 Python 버전 변경</li>
</ol>
<ul>
<li>python 3.8을 python3로 대체하려면 아래와 같이 심볼릭 링크를 업데이트 할 수 있음<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf /usr/bin/python3.8 /usr/bin/python3</span><br></pre></td></tr></table></figure></li>
<li>pip3 역시 Python 3.8에 맞는 버전으로 변경<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf /usr/bin/pip3.8 /usr/bin/pip3</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>Python 버전 확인<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 --version</span><br></pre></td></tr></table></figure></li>
</ol>
<p>이제 Redis 패키지 설치 재시도를 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install redis-5.2.0-py3-none-any.whl --no-index --find-links .</span></span><br><span class="line"></span><br><span class="line">WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.</span><br><span class="line">Looking in links: .</span><br><span class="line">Processing ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">ERROR: Could not find a version that satisfies the requirement async-timeout&gt;=4.0.3; python_full_version &lt; &quot;3.11.3&quot; (from redis)</span><br><span class="line">ERROR: No matching distribution found for async-timeout&gt;=4.0.3; python_full_version &lt; &quot;3.11.3&quot;</span><br></pre></td></tr></table></figure>

<p>이번엔 이런 에러가 나는데, redis 패키지가 async-timeout 패키지의 특정 버전 (&gt;&#x3D;4.0.3)을 필요로 하는데, 현재 환경에서는 해당 버전을 찾을 수 없어서 발생한 것이다.<br>pip download가 기본적으로 상위 패키지만 다운로드하고, 해당 패키지의 모든 의존성을 포함하지 않기 때문이다.<br>모든 의존성 패키지를 포함해 다운로드 하려면 pip에 추가 옵션을 지정해주어야 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip download --no-binary=:all: redis</span><br></pre></td></tr></table></figure>
<ul>
<li>위와 같이 –no-binary 옵션을 사용해 의존성 패키지까지 함께 다운로드 할 수 있다.</li>
<li>redis와 모든 의존성 패키지들이 .whl 또는 .tar.gz 파일로 함께 다운로드 될 것이다.</li>
</ul>
<p>tar.gz 파일을 S3를 통해 EC2로 전송하여 설치를 진행한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws s3 <span class="built_in">cp</span> s3://aipin-bucket/redis-5.2.0.tar.gz /root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar -xzf async-timeout-4.0.3.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> redis-5.2.0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python3 setup.py install</span></span><br></pre></td></tr></table></figure>

<p>그런데 또 에러가 난다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python3 setup.py install</span></span><br><span class="line">/usr/lib64/python3.8/distutils/dist.py:274: UserWarning: Unknown distribution option: &#x27;long_description_content_type&#x27;</span><br><span class="line">  warnings.warn(msg)</span><br><span class="line">running install</span><br><span class="line">error: can&#x27;t create or remove files in install directory</span><br><span class="line"></span><br><span class="line">The following error occurred while trying to add or remove files in the</span><br><span class="line">installation directory:</span><br><span class="line"></span><br><span class="line">    [Errno 2] No such file or directory: &#x27;/usr/local/lib/python3.8/site-packages/test-easy-install-2904.write-test&#x27;</span><br><span class="line"></span><br><span class="line">The installation directory you specified (via --install-dir, --prefix, or</span><br><span class="line">the distutils default setting) was:</span><br><span class="line"></span><br><span class="line">    /usr/local/lib/python3.8/site-packages/</span><br><span class="line"></span><br><span class="line">This directory does not currently exist.  Please create it and try again, or</span><br><span class="line">choose a different installation directory (using the -d or --install-dir</span><br><span class="line">option).</span><br></pre></td></tr></table></figure>

<p>이 오류는 &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F; 디렉토리가 존재하지 않아서 발생한 것이다.</p>
<p>-&gt; 디렉토리 생성 후 설치 시도</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/lib/python3.8/site-packages/</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>이번엔 setup.py를 사용하여 설치할 때 발생하는 marshal 모듈 관련 에러가 난다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;setup.py&quot;, line 4, in &lt;module&gt;</span><br><span class="line">    setup(</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/__init__.py&quot;, line 129, in setup</span><br><span class="line">    return distutils.core.setup(**attrs)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/core.py&quot;, line 148, in setup</span><br><span class="line">    dist.run_commands()</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 966, in run_commands</span><br><span class="line">    self.run_command(cmd)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 985, in run_command</span><br><span class="line">    cmd_obj.run()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/install.py&quot;, line 67, in run</span><br><span class="line">    self.do_egg_install()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/install.py&quot;, line 109, in do_egg_install</span><br><span class="line">    self.run_command(&#x27;bdist_egg&#x27;)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/cmd.py&quot;, line 313, in run_command</span><br><span class="line">    self.distribution.run_command(command)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 985, in run_command</span><br><span class="line">    cmd_obj.run()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 218, in run</span><br><span class="line">    os.path.join(archive_root, &#x27;EGG-INFO&#x27;), self.zip_safe()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 269, in zip_safe</span><br><span class="line">    return analyze_egg(self.bdist_dir, self.stubs)</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 379, in analyze_egg</span><br><span class="line">    safe = scan_module(egg_dir, base, name, stubs) and safe</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 416, in scan_module</span><br><span class="line">    code = marshal.load(f)</span><br><span class="line">ValueError: bad marshal data (unknown type code)</span><br></pre></td></tr></table></figure>

<p>아예 방법을 바꿔서 Redis 서버를 설치하겠다.</p>
<h1 id="Redis-서버-설치"><a href="#Redis-서버-설치" class="headerlink" title="Redis 서버 설치"></a>Redis 서버 설치</h1><p>Redis 서버를 설치하여 EC2 인스턴스에서 직접 Redis 서버를 운영하겠다.</p>
<ol>
<li>인터넷이 연결된 환경에서 Redis 소스파일을 다운로드 한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/redis-stable.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>다운로드한 redis-stable.tar.gz 파일을 EC2 인스턴스로 전송한다.</li>
<li>EC2에서 Redis 압축을 푼다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf redis-stable.tar.gz</span><br><span class="line">cd redis-stable</span><br></pre></td></tr></table></figure></li>
<li>Redis를 컴파일하고 설치한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></li>
<li>Redis 서버를 실행하여 설치가 완료되었는지 확인한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then rebootor run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 * Redis version=7.4.1, bits=64, commit=00000000, modified=0, pid=11366, just started</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br><span class="line">11366:M 07 Nov 2024 18:11:49.254 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ &#x27;&#x27;-._</span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis Community Edition</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._     7.4.1 (00000000/0) 64 bit</span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 11366</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;</span><br><span class="line">          `-._        _.-&#x27;</span><br><span class="line">              `-.__.-&#x27;</span><br><span class="line"></span><br><span class="line">11366:M 07 Nov 2024 18:11:49.255 * Server initialized</span><br><span class="line">11366:M 07 Nov 2024 18:11:49.255 * Ready to accept connections tcp</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 서버의 URL을 지정합니다.</span></span><br><span class="line">REDIS_URL = <span class="string">&quot;redis://localhost:6379/0&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># LANGCHAIN_TRACING_V2 환경 변수를 &quot;true&quot;로 설정합니다.</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_TRACING_V2&quot;</span>] = <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="comment"># LANGCHAIN_PROJECT 설정</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_PROJECT&quot;</span>] = <span class="string">&quot;RunnableWithMessageHistory&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> RedisChatMessageHistory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_message_history</span>(<span class="params">session_id: <span class="built_in">str</span></span>) -&gt; RedisChatMessageHistory:</span><br><span class="line">    <span class="comment"># 세션 ID를 기반으로 RedisChatMessageHistory 객체를 반환합니다.</span></span><br><span class="line">    <span class="keyword">return</span> RedisChatMessageHistory(session_id, url=REDIS_URL)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with_message_history = RunnableWithMessageHistory(</span><br><span class="line">    runnable,  <span class="comment"># 실행 가능한 객체</span></span><br><span class="line">    get_message_history,  <span class="comment"># 메시지 기록을 가져오는 함수</span></span><br><span class="line">    input_messages_key=<span class="string">&quot;input&quot;</span>,  <span class="comment"># 입력 메시지의 키</span></span><br><span class="line">    history_messages_key=<span class="string">&quot;history&quot;</span>,  <span class="comment"># 기록 메시지의 키</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 수학 관련 질문 &quot;코사인의 의미는 무엇인가요?&quot;를 입력으로 전달합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;What does cosine mean?&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 옵션으로 세션 ID를 &quot;redis123&quot; 로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis123&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 이전 답변에 대한 한글 번역을 요청합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;이전의 답변을 한글로 번역해 주세요.&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 값으로 세션 ID를 &quot;foobar&quot;로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis123&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 이전 답변에 대한 한글 번역을 요청합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;이전의 답변을 한글로 번역해 주세요.&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 값으로 세션 ID를 &quot;redis456&quot;로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis456&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="Redis-컨테이너에서…"><a href="#Redis-컨테이너에서…" class="headerlink" title="Redis 컨테이너에서…"></a>Redis 컨테이너에서…</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis-container sh</span><br><span class="line">redis-cli</span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">get message_store:redis456</span><br><span class="line">get message_store:redis123</span><br><span class="line"></span><br><span class="line">LRANGE message_store:redis456</span><br><span class="line">LRANGE message_store:redis123</span><br><span class="line"></span><br><span class="line">hgetall message_store:redis456</span><br><span class="line">hgetall message_store:redis123</span><br><span class="line"></span><br><span class="line">type message_store:redis456</span><br><span class="line">type message_store:redis123</span><br></pre></td></tr></table></figure>

<h1 id="Redis-조회-시"><a href="#Redis-조회-시" class="headerlink" title="Redis 조회 시"></a>Redis 조회 시</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;message_store:redis456&quot;</span><br><span class="line">2) &quot;message_store:redis123&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; lrange message_store:redis456 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc218\\ud559\\uc5d0 \\ub2a5\\uc219\\ud55c \\ub3c4\\uc6b0\\ubbf8\\uc785\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 17, \&quot;prompt_tokens\&quot;: 103, \&quot;total_tokens\&quot;: 120, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-1507d5ba-7bce-458d-b9ff-b6c93252dab3-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 103, \&quot;output_tokens\&quot;: 17, \&quot;total_tokens\&quot;: 120, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">3) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc218\\ud559\\uc5d0 \\ub2a5\\uc219\\ud55c \\ub3c4\\uc6b0\\ubbf8\\uc785\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 17, \&quot;prompt_tokens\&quot;: 60, \&quot;total_tokens\&quot;: 77, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-c7ce147f-2ac9-4068-8405-6bc91669a52e-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 60, \&quot;output_tokens\&quot;: 17, \&quot;total_tokens\&quot;: 77, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">4) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; lrange message_store:redis123 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Shohei Ohtani is a Japanese professional baseball player who plays for the Los Angeles Angels in Major League Baseball (MLB). He is known for his exceptional skills as both a pitcher and a hitter.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 42, \&quot;prompt_tokens\&quot;: 185, \&quot;total_tokens\&quot;: 227, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-8ba62e18-27de-438b-8a88-a85b399951a6-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 185, \&quot;output_tokens\&quot;: 42, \&quot;total_tokens\&quot;: 227, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Who ohtani.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">3) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Cosine is a trigonometric function that represents the ratio of the adjacent side to the hypotenuse in a right triangle.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 26, \&quot;prompt_tokens\&quot;: 146, \&quot;total_tokens\&quot;: 172, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-56f41ea1-25d2-4071-aa8e-24693cc3dead-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 146, \&quot;output_tokens\&quot;: 26, \&quot;total_tokens\&quot;: 172, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">4) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;What does cosine mean?\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">5) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\ucf54\\uc0ac\\uc778\\uc740 \\uc9c1\\uac01 \\uc0bc\\uac01\\ud615\\uc5d0\\uc11c \\uc778\\uc811\\ubcc0\\uacfc \\ube57\\ubcc0\\uc758 \\ube44\\uc728\\uc744 \\ub098\\ud0c0\\ub0c5\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 41, \&quot;prompt_tokens\&quot;: 92, \&quot;total_tokens\&quot;: 133, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-986633f9-22a6-4c16-89d9-3918780b585d-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 92, \&quot;output_tokens\&quot;: 41, \&quot;total_tokens\&quot;: 133, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">6) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">7) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Cosine represents the ratio of the adjacent side to the hypotenuse in a right triangle.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 19, \&quot;prompt_tokens\&quot;: 47, \&quot;total_tokens\&quot;: 66, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-146afcbf-7301-4673-b3d4-0bf6ae2c9191-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 47, \&quot;output_tokens\&quot;: 19, \&quot;total_tokens\&quot;: 66, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">8) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;What does cosine mean?\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="프로젝트에-Redis-저장-및-로드-코드-추가"><a href="#프로젝트에-Redis-저장-및-로드-코드-추가" class="headerlink" title="프로젝트에 Redis 저장 및 로드 코드 추가"></a>프로젝트에 Redis 저장 및 로드 코드 추가</h1><p>아래와 같이 Redis 설정을 추가하고</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 설정</span></span><br><span class="line">redis_client = redis.StrictRedis(</span><br><span class="line">    host=os.getenv(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>),</span><br><span class="line">    port=<span class="built_in">int</span>(os.getenv(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="number">6379</span>)),</span><br><span class="line">    db=<span class="number">0</span>,</span><br><span class="line">    decode_responses=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>대화 히스토리 저장용 함수를 추가하고</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 대화 히스토리 저장용 함수</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_chat_history_to_redis</span>(<span class="params">user_id: <span class="built_in">str</span>, message: <span class="built_in">str</span>, response: <span class="built_in">str</span></span>):</span><br><span class="line">    timestamp = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    user_chat_data = &#123;</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: message</span><br><span class="line">    &#125;</span><br><span class="line">    assistant_chat_data = &#123;</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: response</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 사용자 메시지와 응답을 각각 저장</span></span><br><span class="line">    redis_client.rpush(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, json.dumps(user_chat_data))</span><br><span class="line">    redis_client.rpush(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, json.dumps(assistant_chat_data))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;대화 내용이 저장되었습니다&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>저장된 히스토리를 불러오는 함수도 추가하였다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">user_id: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[ChatFormat]:</span><br><span class="line">    <span class="comment"># Redis에서 user_id에 해당하는 대화 내역을 가져오는 로직 작성</span></span><br><span class="line">    history_data = redis_client.lrange(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>)</span><br><span class="line">    history = [ChatFormat(**json.loads(item)) <span class="keyword">for</span> item <span class="keyword">in</span> history_data]</span><br><span class="line">    <span class="keyword">return</span> history</span><br></pre></td></tr></table></figure>

<p>그리고 Agent 호출 로직에 history를 load 하여 호출하도록 추가하였다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis에서 사용자 대화 기록 가져와 history 대체하기</span></span><br><span class="line">history = get_session_history(user_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GIS AGENT 호출</span></span><br><span class="line">response = call_gis_agent(message, history, summary)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis에 대화 내용 저장</span></span><br><span class="line">save_chat_history_to_redis(user_id, message, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 내역 출력 (optional)</span></span><br><span class="line"><span class="built_in">print</span>(print_session_history(history))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>그리고 비슷하게 summary를 저장하는 로직도 추가하였다.</p>
<p>실행하게 되면 Redis에서 아래와 같이 두 가지 Redis key가 사용자 별로 생성된다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;summary_list:default_user&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;chat_history:default_user&quot;</span></span><br></pre></td></tr></table></figure>

<p>한글로 채팅이 오고 가기 때문에 redis에서 조회해도 다 깨져있고, 로그에서 잘 저장되고 불러오는지 확인해보겠다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">대화 내용이 저장되었습니다</span><br><span class="line">저장된 대화 내용:</span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 효창공원역 맛집 추천해줘</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 효창공원역 주변의 맛집을 추천해드릴게요:</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> <span class="strong">**창성옥**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 새창로 124-10 (용문동 25-16)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-718-2878</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 한식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (소): 27,000원</span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (중): 36,000원</span><br><span class="line"><span class="bullet">     -</span> 해장국: 10,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**영업시간**</span>: 24시간 운영</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**예약 가능 여부**</span>: 가능</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> <span class="strong">**효창동짜장우동**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 백범로 283 (효창동 81-1)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-703-5287</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 중식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 짜장: 4,000원</span><br><span class="line"><span class="bullet">     -</span> 김치우동: 4,000원</span><br><span class="line"><span class="bullet">     -</span> 우동: 4,000원</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> <span class="strong">**박명도봉평메밀막국수**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 원효로 184-1 (원효로2가 43)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-717-7711</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 국수전문</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 들기름막국수: 11,000원</span><br><span class="line"><span class="bullet">     -</span> 물막국수: 11,000원</span><br><span class="line"><span class="bullet">     -</span> 비빔막국수: 11,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**영업시간**</span>: 10:00 - 22:00</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> <span class="strong">**용문해장국**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 효창원로 110 (용문동 8-95)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-712-6290</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 한식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 해장국: 7,000원</span><br><span class="line"><span class="bullet">     -</span> 해장국 (2인분): 14,000원</span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (중): 30,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**예약 가능 여부**</span>: 가능, 주차 가능</span><br><span class="line"></span><br><span class="line"><span class="bullet">5.</span> <span class="strong">**아성녹두빈대떡**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 효창원로48길 3 (용문동 8-113)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-706-8238</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 기타</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>:</span><br><span class="line"><span class="bullet">     -</span> 녹두빈대떡: 15,000원</span><br><span class="line"><span class="bullet">     -</span> 해물파전: 12,000원</span><br><span class="line"><span class="bullet">     -</span> 감자전: 12,000원</span><br><span class="line"></span><br><span class="line"><span class="section">이 맛집들이 효창공원역 근처에서 좋은 선택이 될 것입니다!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집은 반포자이 114동인데, 우리집에서 창성옥까지 얼마나걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 창성옥까지의 소요 시간은 약 24분 30초이며, 거리는 약 12,291 미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 서울역까지 얼마나걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 서울역까지의 소요 시간은 약 33분이며, 거리는 약 9.5킬로미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 아까 알려준 효창공원 맛집 중 첫번째가 어디였지?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 아까 알려드린 효창공원역 맛집 중 첫 번째는 <span class="strong">**창성옥**</span>입니다. 주소는 서울특별시 용산구 새창로 124-10 (용문동 25-16)이고, 전화번호는 02-718-2878입니다. 한식을 제공하며, 뼈전골과 해장국이 주요 메뉴입니다. 24시간 운영하며 예약도 가능합니다.</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 아까 추천해준 효창공원 맛집 중 4번째는 어디였지?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 아까 추천해드린 효창공원역 맛집 중 네 번째는 <span class="strong">**용문해장국**</span>입니다. 주소는 서울특별시 용산구 효창원로 110 (용문동 8-95)이고, 전화번호는 02-712-6290입니다. 한식을 제공하며, 해장국과 뼈전골이 주요 메뉴입니다. 예약이 가능하고 주차도 가능합니다.</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리 부모님집은 도원삼성래미안 아파트야</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 도원삼성래미안 아파트에서 서울역까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 17분 (1074초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 3.965킬로미터 (3965미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전한 운전 되세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 우리부모님집까지 얼마나 걸려</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 도원삼성래미안 아파트까지의 소요 시간은 약 28분이며, 거리는 약 13,026미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 광화문 West 빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 광화문 West 빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 29분 (1766초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 9.3킬로미터 (9307미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전한 운전 되세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 판교빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 판교빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 19분 (1144초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 14.47킬로미터 (14470미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전 운전하세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 판교빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 판교빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간:**</span> 약 19분 17초 (1157초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리:**</span> 약 14,464 미터</span><br><span class="line"></span><br><span class="line"><span class="section">안전 운전하시기 바랍니다!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리부모님집에서 KT 대관령 수련관 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 2시간 34분 (9280초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 197.6킬로미터</span><br><span class="line"></span><br><span class="line"><span class="section">이 정보를 바탕으로 여행을 계획하실 수 있습니다. 추가로 도움이 필요하시면 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">None</span><br><span class="line">/Users/leehamin/app/GIS-Agent/gis-ai-agent-be/agent<span class="emphasis">_api/models/chat_</span>models.py:22: LangChainDeprecationWarning: The class <span class="code">`LLMChain`</span> was deprecated in LangChain 0.1.17 and will be removed in 1.0. Use :meth:<span class="code">`~RunnableSequence, e.g., `</span>prompt | llm`` instead.</span><br><span class="line">  chain = LLMChain(prompt=get<span class="emphasis">_summary_</span>prompt<span class="emphasis">_template(), llm=llm)</span></span><br><span class="line"><span class="emphasis">Summary list가 저장되었습니다.</span></span><br><span class="line"><span class="emphasis">answer_</span>data:  &#123;&#x27;answer&#x27;: &#x27;반포자이 114동에서 KT위즈파크까지의 경로 안내는 이미 완료되었습니다. 경로는 반포자이 114동에서 출발하여 신반포로를 따라 남쪽으로 이동한 후, 반포대교를 건너 수원 방향으로 계속 이동하여 경수대로를 따라 KT위즈파크에 도착하는 것입니다. 안전한 여행 되세요!&#x27;, &#x27;chat<span class="emphasis">_status&#x27;: &#x27;C1001&#x27;&#125;</span></span><br><span class="line"><span class="emphasis">answer_</span>summary<span class="emphasis">_list :  [&#x27;사용자가 효창공원역 근처 맛집을 추천받고, 그 중 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 또한, 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, 그리고 KT 판교빌딩까지의 소요 시간과 거리를 문의하여 답변을 받았습니다.&#x27;, &#x27;사용자가 효창공원역 근처 맛집을 추천받고, 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, KT 판교빌딩, 그리고 KT 대관령 수련관까지의 소요 시간과 거리를 문의하여 답변을 받았습니다. 또한, 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 정보를 확인했습니다.&#x27;, &#x27;사용자가 효창공원역 근처 맛집을 추천받고, 그 중 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 또한, 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, KT 판교빌딩, 그리고 KT 대관령 수련관까지의 소요 시간과 거리를 문의하여 답변을 받았습니다. 사용자는 효창공원역 맛집 추천을 다시 요청했고, 첫 번째와 네 번째 맛집의 정보를 다시 확인했습니다. 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 정보도 확인했으며, 반포자이 114동에서 KT위즈파크까지의 소요 시간과 경로를 안내받았습니다.&#x27;]</span></span><br><span class="line"><span class="emphasis">INFO:     127.0.0.1:51812 - &quot;POST /api/v1/chat HTTP/1.1&quot; 200 OK</span></span><br></pre></td></tr></table></figure>

<p>위와 같이 대화 내용과 summary_list가 모두 잘 저장되고 load되며 멀티턴 또한 잘 진행된다.</p>
<h1 id="User-별로-대화가-저장되도록-user-uuid-적용"><a href="#User-별로-대화가-저장되도록-user-uuid-적용" class="headerlink" title="User 별로 대화가 저장되도록 user_uuid 적용"></a>User 별로 대화가 저장되도록 user_uuid 적용</h1><p>더미로 default_user라는 user_id로 통일하던 것을<br>유저별로 대화 history와 summary가 적용될 수 있도록, 식별자인 user_uuid를 적용하였다.</p>
<p>헤더에 X-User-UUID를 달고 가는 방식이다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_or_get_uuid</span>(<span class="params">user_uuid: <span class="type">Optional</span>[<span class="built_in">str</span>]</span>) -&gt; UUID:</span><br><span class="line">    <span class="keyword">if</span> user_uuid:</span><br><span class="line">        <span class="keyword">try</span>: <span class="comment"># UUID가 유효한지 검사</span></span><br><span class="line">            <span class="keyword">return</span> UUID(user_uuid)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            raise_error(<span class="string">&quot;E1006&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># UUID가 없으면 새 UUID 생성</span></span><br><span class="line">        <span class="keyword">return</span> uuid4()</span><br></pre></td></tr></table></figure>

<p>유저 아이디에 맞게 redis key가 생성된다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;summary_list:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;summary_list:default_user&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;chat_history:default_user&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-세션1"><a href="#테스트-세션1" class="headerlink" title="테스트 세션1"></a>테스트 세션1</h2><h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;우리집은 판교 그랑블 아파트야, 우리집 좌표 알고 있니?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;네, 판교 그랑블 아파트의 좌표는 다음과 같습니다:\n- 위도: 37.3933\n- 경도: 127.1144\n\n더 필요한 정보가 있으면 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-세션2"><a href="#테스트-세션2" class="headerlink" title="테스트 세션2"></a>테스트 세션2</h2><h3 id="Request-1"><a href="#Request-1" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;효창공원 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;효창공원 주변의 맛집 정보는 다음과 같습니다:\n\n1. **효창원**  \n   - **주소**: 서울 용산구 효창원로 97\n   - **특징**: 전통 한식과 다양한 메뉴를 제공하는 식당입니다.\n\n2. **카페 드 파리**  \n   - **주소**: 서울 용산구 효창원로 85\n   - **특징**: 디저트와 커피를 전문으로 하는 아늑한 카페입니다.\n\n3. **고기리 막창**  \n   - **주소**: 서울 용산구 효창원로 95\n   - **특징**: 고기 요리를 전문으로 하는 맛집으로, 막창이 유명합니다.\n\n이 외에도 더 많은 맛집이 있으니, 필요하시면 추가 정보를 요청해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션3"><a href="#테스트-세션3" class="headerlink" title="테스트 세션3"></a>테스트 세션3</h2><h3 id="Request-2"><a href="#Request-2" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;첫번째 것으로 할래! 우리집에서 거기까지 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-2"><a href="#Response-2" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원까지의 소요 시간은 약 49분입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션4"><a href="#테스트-세션4" class="headerlink" title="테스트 세션4"></a>테스트 세션4</h2><h3 id="Request-3"><a href="#Request-3" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그럼 집에서 출발해서 거기서 밥먹고, 김포공항 가면 얼마나 걸릴까?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-3"><a href="#Response-3" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원으로 이동한 후, 효창원에서 김포공항까지 이동하는 데 걸리는 총 소요 시간은 다음과 같습니다:\n\n- **판교 그랑블 아파트 → 효창원**: 약 41분 38초\n- **효창원 → 김포공항**: 약 56분 4초\n\n따라서, 총 소요 시간은 약 1시간 37분 42초입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션5"><a href="#테스트-세션5" class="headerlink" title="테스트 세션5"></a>테스트 세션5</h2><h3 id="Request-4"><a href="#Request-4" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그러면 김포공항 대신 인천공항으로 가면 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-4"><a href="#Response-4" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원까지의 소요 시간은 약 1시간 10분이며, 효창원에서 인천공항까지의 소요 시간은 약 47분입니다. 따라서, 총 소요 시간은 약 1시간 57분입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다. 사용자가 인천공항으로 가는 시간을 묻자, 어시스턴트는 총 소요 시간이 약 1시간 57분이라고 안내합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="서버에-배포"><a href="#서버에-배포" class="headerlink" title="서버에 배포"></a>서버에 배포</h1><p>프로젝트에서 requirements.txt 파일을 사용하고 있기 때문에, 이 파일에 redis 패키지를 추가했다.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis</span><br></pre></td></tr></table></figure>

<p>Redis가 실행되고 있는 호스트의 IP로 바꾸었다</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># host=os.getenv(&#x27;REDIS_HOST&#x27;, &#x27;localhost&#x27;),</span></span><br><span class="line">host=os.getenv(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;10.71.176.93&#x27;</span>),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EC2 환경</span></span><br><span class="line">redis_url = os.getenv(<span class="string">&quot;REDIS_URL&quot;</span>, <span class="string">&quot;redis://10.71.176.93:6379/0&quot;</span>)</span><br><span class="line"><span class="comment"># 로컬 환경</span></span><br><span class="line"><span class="comment"># redis_url = os.getenv(&quot;REDIS_URL&quot;, &quot;redis://localhost:6379/0&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-서버가-외부-연결을-허용하는지-확인"><a href="#Redis-서버가-외부-연결을-허용하는지-확인" class="headerlink" title="Redis 서버가 외부 연결을 허용하는지 확인"></a>Redis 서버가 외부 연결을 허용하는지 확인</h2><h3 id="Redis-설정파일-위치-확인"><a href="#Redis-설정파일-위치-확인" class="headerlink" title="Redis 설정파일 위치 확인"></a>Redis 설정파일 위치 확인</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 설정 파일 위치 확인</span></span><br><span class="line">find / -name &quot;redis.conf&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Redis-설정-파일-수정"><a href="#Redis-설정-파일-수정" class="headerlink" title="Redis 설정 파일 수정"></a>Redis 설정 파일 수정</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">이렇게 있던 것을</span></span><br><span class="line">bind 127.0.0.1 -::1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">이렇게</span></span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>

<h3 id="Redis-재시작"><a href="#Redis-재시작" class="headerlink" title="Redis 재시작"></a>Redis 재시작</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 서버의 프로세스 ID 확인</span></span><br><span class="line">ps aux | grep redis-server</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">프로세스 ID를 이용해 종료 (예: PID가 1234인 경우)</span></span><br><span class="line">kill 1234</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 서버 재시작</span></span><br><span class="line">redis-server /path/to/redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="여전히-protected-mode가-실행중으로-나타난다"><a href="#여전히-protected-mode가-실행중으로-나타난다" class="headerlink" title="여전히 protected mode가 실행중으로 나타난다"></a>여전히 protected mode가 실행중으로 나타난다</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# curl -v telnet://10.71.176.93:6379</span><br><span class="line">*   Trying 10.71.176.93:6379...</span><br><span class="line">* Connected to 10.71.176.93 (10.71.176.93) port 6379</span><br><span class="line">-DENIED Redis is running in protected mode because protected mode is enabled and no password is set for the default user. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server. 3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option. 4) Set up an authentication password for the default user. NOTE:You only need to do one of the above things in order for the server to start accepting connections from the outside.</span><br></pre></td></tr></table></figure>

<ul>
<li>Redis CLI를 통해 임시로 protected-mode 비활성화<br>Redis 서버에 접근 가능한 경우, Redis CLI를 사용하여 protected-mode를 비활성화할 수 있다.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis CLI 접속</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">protected-mode 비활성화</span></span><br><span class="line">CONFIG SET protected-mode no</span><br><span class="line"></span><br><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# curl -v telnet://10.71.176.93:6379</span><br><span class="line">*   Trying 10.71.176.93:6379...</span><br><span class="line">* Connected to 10.71.176.93 (10.71.176.93) port 6379</span><br></pre></td></tr></table></figure>

<p>이번엔 연결이 되는 것 같다</p>
<h1 id="서버-테스트"><a href="#서버-테스트" class="headerlink" title="서버 테스트"></a>서버 테스트</h1><h2 id="테스트-1"><a href="#테스트-1" class="headerlink" title="테스트 1"></a>테스트 1</h2><h3 id="Request-5"><a href="#Request-5" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;우리집은 판교 그랑블 아파트야, 우리집 좌표 알고 있니?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-5"><a href="#Response-5" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트의 좌표는 다음과 같습니다:\n\n- **위도**: 37.393299557105\n- **경도**: 127.11436915566647\n\n이 정보가 도움이 되길 바랍니다! 추가적인 질문이 있으면 언제든지 말씀해 주세요.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-2"><a href="#테스트-2" class="headerlink" title="테스트 2"></a>테스트 2</h2><h3 id="Request-6"><a href="#Request-6" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;포천 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-6"><a href="#Response-6" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;포천의 맛집 정보를 제공해드렸습니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-3"><a href="#테스트-3" class="headerlink" title="테스트 3"></a>테스트 3</h2><h3 id="Request-7"><a href="#Request-7" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;영종도 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-7"><a href="#Response-7" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;영종도에서 추천하는 맛집 목록입니다:\n\n1. **선녀풍**\n   - 주소: 인천광역시 중구 을왕동 용유서로 272, 689-1\n   - 전화: 032-751-2121\n   - 주메뉴: 해물파전(15,000원), 선녀물회(20,000원), 낙지물회(28,000원)\n   - 영업시간: 매일 12:00 - 22:00\n   - 주차: 가능\n   - 좌표: [37.4444, 126.3787]\n\n2. **황해해물칼국수**\n   - 주소: 인천광역시 중구 덕교동 마시란로 37, 128-56\n   - 전화: 032-752-3017\n   - 주메뉴: 산낙지(15,000원), 전복 (4마리)(16,000원), 해물칼국수(10,000원)\n   - 영업시간: 매일 10:00 - 20:00\n   - 주차: 가능\n   - 좌표: [37.4262, 126.4212]\n\n3. **동해막국수**\n   - 주소: 인천광역시 중구 을왕동 용유서로479번길 16, 859-3\n   - 전화: 032-746-5522\n   - 영업시간: 매일 11:00 - 21:00\n   - 주차: 가능\n   - 좌표: [37.4616, 126.3705]\n\n4. **미애네칼국수**\n   - 주소: 인천광역시 중구 덕교동 용유로21번길 51, 80-14\n   - 전화: 032-746-3838\n   - 주메뉴: 산낙지(18,000원), 전복회(15,000원), 바다속칼국수 (소)(35,000원)\n   - 영업시간: 매일 09:00 - 21:00\n   - 주차: 가능\n   - 좌표: [37.4300, 126.4242]\n\n5. **을항**\n   - 주소: 인천광역시 중구 을왕동 선녀바위로55번길 39, 686-5\n   - 전화: 032-752-2227\n   - 주메뉴: 물회(1인)(25,000원), 물회(대)(75,000원), 물회(중)(55,000원)\n   - 좌표: [37.4436, 126.3782]\n\n맛집 선택에 도움이 되길 바랍니다!&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span>---</span><br><span class="line">title<span class="punctuation">:</span> LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기</span><br><span class="line">date<span class="punctuation">:</span> <span class="number">2024</span><span class="number">-11</span><span class="number">-03</span> <span class="number">22</span><span class="punctuation">:</span><span class="number">37</span><span class="punctuation">:</span><span class="number">01</span></span><br><span class="line">tags<span class="punctuation">:</span></span><br><span class="line">  - LangChain</span><br><span class="line">  - LLM</span><br><span class="line">  - Redis</span><br><span class="line">  - <span class="punctuation">[</span>LLM<span class="punctuation">,</span> LangChain<span class="punctuation">]</span></span><br><span class="line">cover<span class="punctuation">:</span> /gallery/langChain.png</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">LangChain의 RunnableWithMessage는 LangChain에서 제공하는 유틸리티 클래스로<span class="punctuation">,</span> 주로 챗봇 애플리케이션 개발 시 이전의 대화 히스토리와 상호작용을 관리하기 위해 사용된다.</span><br><span class="line">이 클래스는 주로 대화 기록을 저장하고 관리하여 대화 흐름을 유지하거나 개인화된 응답을 생성하는데 유용하다.</span><br><span class="line"></span><br><span class="line">기본적으로 RunnableWithHistory 클래스는 대화 세션 내에서 사용자와 AI간의 대화 히스토리를 지속적으로 기록할 수 있도록 해주며<span class="punctuation">,</span> 필요한 경우 특정 조건에 따라 히스토리를 요약하거나 일부 삭제할 수 있는 기능도 제공한다.</span><br><span class="line">이를통해 챗봇이 각 세션마다 대화 컨텍스트를 유지할 수 있어 더욱 자연스러운 대화 경험을 제공한다.</span><br><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line">~~~python</span><br><span class="line">from dotenv import load_dotenv</span><br><span class="line"></span><br><span class="line">load_dotenv(dotenv_path=<span class="string">&quot;../.env&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span><br><span class="line"><span class="comment"># !pip install langchain-teddynote</span></span><br><span class="line"><span class="keyword">from</span> langchain_teddynote <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프로젝트 이름을 입력합니다.</span></span><br><span class="line">logging.langsmith(<span class="string">&quot;langchain-Memory&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span><br><span class="line"><span class="comment"># !pip install langchain-teddynote</span></span><br><span class="line"><span class="keyword">from</span> langchain_teddynote <span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 프로젝트 이름을 입력합니다.</span></span><br><span class="line">logging.langsmith(<span class="string">&quot;langchain-Memory&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_core.prompts <span class="keyword">import</span> ChatPromptTemplate, MessagesPlaceholder</span><br><span class="line"><span class="keyword">from</span> langchain_openai <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"></span><br><span class="line">model = ChatOpenAI()</span><br><span class="line">prompt = ChatPromptTemplate.from_messages(</span><br><span class="line">    [</span><br><span class="line">        (</span><br><span class="line">            <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;당신은 &#123;ability&#125; 에 능숙한 어시스턴트입니다. 20자 이내로 응답하세요&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="comment"># 대화 기록을 변수로 사용, history 가 MessageHistory 의 key 가 됨</span></span><br><span class="line">        MessagesPlaceholder(variable_name=<span class="string">&quot;history&quot;</span>),</span><br><span class="line">        (<span class="string">&quot;human&quot;</span>, <span class="string">&quot;&#123;input&#125;&quot;</span>),  <span class="comment"># 사용자 입력을 변수로 사용</span></span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line">runnable = prompt | model  <span class="comment"># 프롬프트와 모델을 연결하여 runnable 객체 생성</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> ChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.chat_history <span class="keyword">import</span> BaseChatMessageHistory</span><br><span class="line"><span class="keyword">from</span> langchain_core.runnables.history <span class="keyword">import</span> RunnableWithMessageHistory</span><br><span class="line"></span><br><span class="line">store = &#123;&#125;  <span class="comment"># 세션 기록을 저장할 딕셔너리</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 세션 ID를 기반으로 세션 기록을 가져오는 함수</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">session_ids: <span class="built_in">str</span></span>) -&gt; BaseChatMessageHistory:</span><br><span class="line">    <span class="built_in">print</span>(session_ids)</span><br><span class="line">    <span class="keyword">if</span> session_ids <span class="keyword">not</span> <span class="keyword">in</span> store:  <span class="comment"># 세션 ID가 store에 없는 경우</span></span><br><span class="line">        <span class="comment"># 새로운 ChatMessageHistory 객체를 생성하여 store에 저장</span></span><br><span class="line">        store[session_ids] = ChatMessageHistory()</span><br><span class="line">    <span class="keyword">return</span> store[session_ids]  <span class="comment"># 해당 세션 ID에 대한 세션 기록 반환</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with_message_history = (</span><br><span class="line">    RunnableWithMessageHistory(  <span class="comment"># RunnableWithMessageHistory 객체 생성</span></span><br><span class="line">        runnable,  <span class="comment"># 실행할 Runnable 객체</span></span><br><span class="line">        get_session_history,  <span class="comment"># 세션 기록을 가져오는 함수</span></span><br><span class="line">        input_messages_key=<span class="string">&quot;input&quot;</span>,  <span class="comment"># 입력 메시지의 키</span></span><br><span class="line">        history_messages_key=<span class="string">&quot;history&quot;</span>,  <span class="comment"># 기록 메시지의 키</span></span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="영구-저장소-Persistent-Storage-1"><a href="#영구-저장소-Persistent-Storage-1" class="headerlink" title="영구 저장소 (Persistent Storage)"></a>영구 저장소 (Persistent Storage)</h1><p>영구 저장소(Persistent Storage)는 프로그램이 종료되거나 시스템이 재부팅되더라도 데이터를 유지하는 저장 메커니즘을 말한다.<br>이는 데이터베이스, 파일시스템, 또는 기타 비휘발성 저장 장치를 통해 구현될 수 있다.</p>
<p>영구 저장소는 애플리케이션의 상태를 저장하고, 사용자 설정을 유지하며, 장기간 데이터를 보존하는 데 필수적이다.<br>이를 통해 프로그램은 이전 실행에서 중단된 지점부터 다시 시작할 수 있으며, 사용자는 데이터 손실 없이 작업을 계속 할 수 있다.</p>
<ul>
<li>RunnableWithMessageHistory는 get_session_history 호출 가능 객체가 채팅 메시지 기록을 어떻게 검색하는지에 대해 독립적이다.</li>
</ul>
<h2 id="Redis-설치-1"><a href="#Redis-설치-1" class="headerlink" title="Redis 설치"></a>Redis 설치</h2><p>Redis가 설치되어 있지 않다면 먼저 설치해야 한다.</p>
<p>폐쇄망 EC2이기 때문에, 인터넷이 연결된 로컬 컴퓨터에서 EC2 서버에 설치할 패키지를 다운로드 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">% </span><span class="language-bash">pip download redis</span></span><br><span class="line">Collecting redis</span><br><span class="line">  Using cached redis-5.2.0-py3-none-any.whl.metadata (9.1 kB)</span><br><span class="line">Using cached redis-5.2.0-py3-none-any.whl (261 kB)</span><br><span class="line">Saved ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">Successfully downloaded redis</span><br></pre></td></tr></table></figure>

<p>S3에 redis whl 파일을 업로드한다.<br>그리고 EC2에 S3에서 whl 파일을 가져온다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws configure</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> AWS_ACCESS_KEY_ID=...</span></span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws s3 <span class="built_in">cp</span> s3://aipin-bucket/redis-5.2.0-py3-none-any.whl /root</span></span><br><span class="line">download: s3://aipin-bucket/redis-5.2.0-py3-none-any.whl to ./redis-5.2.0-py3-none-any.whl</span><br></pre></td></tr></table></figure>

<p>다운로드한 파일들을 EC2에서 설치한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install redis-5.2.0-py3-none-any.whl --no-index --find-links .</span></span><br><span class="line">WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.</span><br><span class="line">Looking in links: .</span><br><span class="line">Processing ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">ERROR: Package &#x27;redis&#x27; requires a different Python: 3.7.16 not in &#x27;&gt;=3.8&#x27;</span><br></pre></td></tr></table></figure>
<ul>
<li>–no-index 옵션을 사용하여 외부 PyPI에 접속하지 않고, 지정된 디렉토리(–find-links .)에서만 패키지를 찾도록 한다.</li>
<li>redis 패키지가 Python3.8 이상의 버전을 요구하고 현재 시스템에 설치된 Python 버전이 3.7.16이기 때문에, Python 3.8이상으로 업그레이드 해야한다.</li>
</ul>
<h2 id="Python-버전-업그레이드-방법-Amazon-Linux-환경-1"><a href="#Python-버전-업그레이드-방법-Amazon-Linux-환경-1" class="headerlink" title="Python 버전 업그레이드 방법 (Amazon Linux 환경)"></a>Python 버전 업그레이드 방법 (Amazon Linux 환경)</h2><ol>
<li>Python 3.8 설치<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y amazon-linux-extras</span><br><span class="line">sudo amazon-linux-extras enable python3.8</span><br><span class="line">sudo yum install -y python3.8</span><br></pre></td></tr></table></figure></li>
<li>기본 Python 버전 변경</li>
</ol>
<ul>
<li>python 3.8을 python3로 대체하려면 아래와 같이 심볼릭 링크를 업데이트 할 수 있음<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf /usr/bin/python3.8 /usr/bin/python3</span><br></pre></td></tr></table></figure></li>
<li>pip3 역시 Python 3.8에 맞는 버전으로 변경<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf /usr/bin/pip3.8 /usr/bin/pip3</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>Python 버전 확인<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 --version</span><br></pre></td></tr></table></figure></li>
</ol>
<p>이제 Redis 패키지 설치 재시도를 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pip3 install redis-5.2.0-py3-none-any.whl --no-index --find-links .</span></span><br><span class="line"></span><br><span class="line">WARNING: Running pip install with root privileges is generally not a good idea. Try `pip3 install --user` instead.</span><br><span class="line">Looking in links: .</span><br><span class="line">Processing ./redis-5.2.0-py3-none-any.whl</span><br><span class="line">ERROR: Could not find a version that satisfies the requirement async-timeout&gt;=4.0.3; python_full_version &lt; &quot;3.11.3&quot; (from redis)</span><br><span class="line">ERROR: No matching distribution found for async-timeout&gt;=4.0.3; python_full_version &lt; &quot;3.11.3&quot;</span><br></pre></td></tr></table></figure>

<p>이번엔 이런 에러가 나는데, redis 패키지가 async-timeout 패키지의 특정 버전 (&gt;&#x3D;4.0.3)을 필요로 하는데, 현재 환경에서는 해당 버전을 찾을 수 없어서 발생한 것이다.<br>pip download가 기본적으로 상위 패키지만 다운로드하고, 해당 패키지의 모든 의존성을 포함하지 않기 때문이다.<br>모든 의존성 패키지를 포함해 다운로드 하려면 pip에 추가 옵션을 지정해주어야 한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip download --no-binary=:all: redis</span><br></pre></td></tr></table></figure>
<ul>
<li>위와 같이 –no-binary 옵션을 사용해 의존성 패키지까지 함께 다운로드 할 수 있다.</li>
<li>redis와 모든 의존성 패키지들이 .whl 또는 .tar.gz 파일로 함께 다운로드 될 것이다.</li>
</ul>
<p>tar.gz 파일을 S3를 통해 EC2로 전송하여 설치를 진행한다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">aws s3 <span class="built_in">cp</span> s3://aipin-bucket/redis-5.2.0.tar.gz /root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tar -xzf async-timeout-4.0.3.tar.gz</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> redis-5.2.0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python3 setup.py install</span></span><br></pre></td></tr></table></figure>

<p>그런데 또 에러가 난다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">python3 setup.py install</span></span><br><span class="line">/usr/lib64/python3.8/distutils/dist.py:274: UserWarning: Unknown distribution option: &#x27;long_description_content_type&#x27;</span><br><span class="line">  warnings.warn(msg)</span><br><span class="line">running install</span><br><span class="line">error: can&#x27;t create or remove files in install directory</span><br><span class="line"></span><br><span class="line">The following error occurred while trying to add or remove files in the</span><br><span class="line">installation directory:</span><br><span class="line"></span><br><span class="line">    [Errno 2] No such file or directory: &#x27;/usr/local/lib/python3.8/site-packages/test-easy-install-2904.write-test&#x27;</span><br><span class="line"></span><br><span class="line">The installation directory you specified (via --install-dir, --prefix, or</span><br><span class="line">the distutils default setting) was:</span><br><span class="line"></span><br><span class="line">    /usr/local/lib/python3.8/site-packages/</span><br><span class="line"></span><br><span class="line">This directory does not currently exist.  Please create it and try again, or</span><br><span class="line">choose a different installation directory (using the -d or --install-dir</span><br><span class="line">option).</span><br></pre></td></tr></table></figure>

<p>이 오류는 &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.8&#x2F;site-packages&#x2F; 디렉토리가 존재하지 않아서 발생한 것이다.</p>
<p>-&gt; 디렉토리 생성 후 설치 시도</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/lib/python3.8/site-packages/</span><br><span class="line">sudo python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>이번엔 setup.py를 사용하여 설치할 때 발생하는 marshal 모듈 관련 에러가 난다.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;setup.py&quot;, line 4, in &lt;module&gt;</span><br><span class="line">    setup(</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/__init__.py&quot;, line 129, in setup</span><br><span class="line">    return distutils.core.setup(**attrs)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/core.py&quot;, line 148, in setup</span><br><span class="line">    dist.run_commands()</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 966, in run_commands</span><br><span class="line">    self.run_command(cmd)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 985, in run_command</span><br><span class="line">    cmd_obj.run()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/install.py&quot;, line 67, in run</span><br><span class="line">    self.do_egg_install()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/install.py&quot;, line 109, in do_egg_install</span><br><span class="line">    self.run_command(&#x27;bdist_egg&#x27;)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/cmd.py&quot;, line 313, in run_command</span><br><span class="line">    self.distribution.run_command(command)</span><br><span class="line">  File &quot;/usr/lib64/python3.8/distutils/dist.py&quot;, line 985, in run_command</span><br><span class="line">    cmd_obj.run()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 218, in run</span><br><span class="line">    os.path.join(archive_root, &#x27;EGG-INFO&#x27;), self.zip_safe()</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 269, in zip_safe</span><br><span class="line">    return analyze_egg(self.bdist_dir, self.stubs)</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 379, in analyze_egg</span><br><span class="line">    safe = scan_module(egg_dir, base, name, stubs) and safe</span><br><span class="line">  File &quot;/usr/lib/python3.8/site-packages/setuptools/command/bdist_egg.py&quot;, line 416, in scan_module</span><br><span class="line">    code = marshal.load(f)</span><br><span class="line">ValueError: bad marshal data (unknown type code)</span><br></pre></td></tr></table></figure>

<p>아예 방법을 바꿔서 Redis 서버를 설치하겠다.</p>
<h1 id="Redis-서버-설치-1"><a href="#Redis-서버-설치-1" class="headerlink" title="Redis 서버 설치"></a>Redis 서버 설치</h1><p>Redis 서버를 설치하여 EC2 인스턴스에서 직접 Redis 서버를 운영하겠다.</p>
<ol>
<li>인터넷이 연결된 환경에서 Redis 소스파일을 다운로드 한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.redis.io/redis-stable.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>다운로드한 redis-stable.tar.gz 파일을 EC2 인스턴스로 전송한다.</li>
<li>EC2에서 Redis 압축을 푼다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf redis-stable.tar.gz</span><br><span class="line">cd redis-stable</span><br></pre></td></tr></table></figure></li>
<li>Redis를 컴파일하고 설치한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></li>
<li>Redis 서버를 실행하여 설치가 완료되었는지 확인한다.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#x27;vm.overcommit_memory = 1&#x27; to /etc/sysctl.conf and then rebootor run the command &#x27;sysctl vm.overcommit_memory=1&#x27; for this to take effect.</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 * Redis version=7.4.1, bits=64, commit=00000000, modified=0, pid=11366, just started</span><br><span class="line">11366:C 07 Nov 2024 18:11:49.254 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span><br><span class="line">11366:M 07 Nov 2024 18:11:49.254 * monotonic clock: POSIX clock_gettime</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ &#x27;&#x27;-._</span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis Community Edition</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._     7.4.1 (00000000/0) 64 bit</span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 11366</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           https://redis.io</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;</span><br><span class="line">          `-._        _.-&#x27;</span><br><span class="line">              `-.__.-&#x27;</span><br><span class="line"></span><br><span class="line">11366:M 07 Nov 2024 18:11:49.255 * Server initialized</span><br><span class="line">11366:M 07 Nov 2024 18:11:49.255 * Ready to accept connections tcp</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 서버의 URL을 지정합니다.</span></span><br><span class="line">REDIS_URL = <span class="string">&quot;redis://localhost:6379/0&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># LANGCHAIN_TRACING_V2 환경 변수를 &quot;true&quot;로 설정합니다.</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_TRACING_V2&quot;</span>] = <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="comment"># LANGCHAIN_PROJECT 설정</span></span><br><span class="line">os.environ[<span class="string">&quot;LANGCHAIN_PROJECT&quot;</span>] = <span class="string">&quot;RunnableWithMessageHistory&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.chat_message_histories <span class="keyword">import</span> RedisChatMessageHistory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_message_history</span>(<span class="params">session_id: <span class="built_in">str</span></span>) -&gt; RedisChatMessageHistory:</span><br><span class="line">    <span class="comment"># 세션 ID를 기반으로 RedisChatMessageHistory 객체를 반환합니다.</span></span><br><span class="line">    <span class="keyword">return</span> RedisChatMessageHistory(session_id, url=REDIS_URL)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with_message_history = RunnableWithMessageHistory(</span><br><span class="line">    runnable,  <span class="comment"># 실행 가능한 객체</span></span><br><span class="line">    get_message_history,  <span class="comment"># 메시지 기록을 가져오는 함수</span></span><br><span class="line">    input_messages_key=<span class="string">&quot;input&quot;</span>,  <span class="comment"># 입력 메시지의 키</span></span><br><span class="line">    history_messages_key=<span class="string">&quot;history&quot;</span>,  <span class="comment"># 기록 메시지의 키</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 수학 관련 질문 &quot;코사인의 의미는 무엇인가요?&quot;를 입력으로 전달합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;What does cosine mean?&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 옵션으로 세션 ID를 &quot;redis123&quot; 로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis123&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 이전 답변에 대한 한글 번역을 요청합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;이전의 답변을 한글로 번역해 주세요.&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 값으로 세션 ID를 &quot;foobar&quot;로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis123&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">with_message_history.invoke(</span><br><span class="line">    <span class="comment"># 이전 답변에 대한 한글 번역을 요청합니다.</span></span><br><span class="line">    &#123;<span class="string">&quot;ability&quot;</span>: <span class="string">&quot;math&quot;</span>, <span class="string">&quot;input&quot;</span>: <span class="string">&quot;이전의 답변을 한글로 번역해 주세요.&quot;</span>&#125;,</span><br><span class="line">    <span class="comment"># 설정 값으로 세션 ID를 &quot;redis456&quot;로 지정합니다.</span></span><br><span class="line">    config=&#123;<span class="string">&quot;configurable&quot;</span>: &#123;<span class="string">&quot;session_id&quot;</span>: <span class="string">&quot;redis456&quot;</span>&#125;&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h1 id="Redis-컨테이너에서…-1"><a href="#Redis-컨테이너에서…-1" class="headerlink" title="Redis 컨테이너에서…"></a>Redis 컨테이너에서…</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis-container sh</span><br><span class="line">redis-cli</span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">get message_store:redis456</span><br><span class="line">get message_store:redis123</span><br><span class="line"></span><br><span class="line">LRANGE message_store:redis456</span><br><span class="line">LRANGE message_store:redis123</span><br><span class="line"></span><br><span class="line">hgetall message_store:redis456</span><br><span class="line">hgetall message_store:redis123</span><br><span class="line"></span><br><span class="line">type message_store:redis456</span><br><span class="line">type message_store:redis123</span><br></pre></td></tr></table></figure>

<h1 id="Redis-조회-시-1"><a href="#Redis-조회-시-1" class="headerlink" title="Redis 조회 시"></a>Redis 조회 시</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;message_store:redis456&quot;</span><br><span class="line">2) &quot;message_store:redis123&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; lrange message_store:redis456 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc218\\ud559\\uc5d0 \\ub2a5\\uc219\\ud55c \\ub3c4\\uc6b0\\ubbf8\\uc785\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 17, \&quot;prompt_tokens\&quot;: 103, \&quot;total_tokens\&quot;: 120, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-1507d5ba-7bce-458d-b9ff-b6c93252dab3-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 103, \&quot;output_tokens\&quot;: 17, \&quot;total_tokens\&quot;: 120, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">3) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc218\\ud559\\uc5d0 \\ub2a5\\uc219\\ud55c \\ub3c4\\uc6b0\\ubbf8\\uc785\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 17, \&quot;prompt_tokens\&quot;: 60, \&quot;total_tokens\&quot;: 77, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-c7ce147f-2ac9-4068-8405-6bc91669a52e-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 60, \&quot;output_tokens\&quot;: 17, \&quot;total_tokens\&quot;: 77, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">4) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; lrange message_store:redis123 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Shohei Ohtani is a Japanese professional baseball player who plays for the Los Angeles Angels in Major League Baseball (MLB). He is known for his exceptional skills as both a pitcher and a hitter.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 42, \&quot;prompt_tokens\&quot;: 185, \&quot;total_tokens\&quot;: 227, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-8ba62e18-27de-438b-8a88-a85b399951a6-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 185, \&quot;output_tokens\&quot;: 42, \&quot;total_tokens\&quot;: 227, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Who ohtani.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">3) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Cosine is a trigonometric function that represents the ratio of the adjacent side to the hypotenuse in a right triangle.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 26, \&quot;prompt_tokens\&quot;: 146, \&quot;total_tokens\&quot;: 172, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-56f41ea1-25d2-4071-aa8e-24693cc3dead-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 146, \&quot;output_tokens\&quot;: 26, \&quot;total_tokens\&quot;: 172, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">4) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;What does cosine mean?\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">5) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\ucf54\\uc0ac\\uc778\\uc740 \\uc9c1\\uac01 \\uc0bc\\uac01\\ud615\\uc5d0\\uc11c \\uc778\\uc811\\ubcc0\\uacfc \\ube57\\ubcc0\\uc758 \\ube44\\uc728\\uc744 \\ub098\\ud0c0\\ub0c5\\ub2c8\\ub2e4.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 41, \&quot;prompt_tokens\&quot;: 92, \&quot;total_tokens\&quot;: 133, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-986633f9-22a6-4c16-89d9-3918780b585d-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 92, \&quot;output_tokens\&quot;: 41, \&quot;total_tokens\&quot;: 133, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">6) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;\\uc774\\uc804\\uc758 \\ub2f5\\ubcc0\\uc744 \\ud55c\\uae00\\ub85c \\ubc88\\uc5ed\\ud574 \\uc8fc\\uc138\\uc694.\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br><span class="line">7) &quot;&#123;\&quot;type\&quot;: \&quot;ai\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;Cosine represents the ratio of the adjacent side to the hypotenuse in a right triangle.\&quot;, \&quot;additional_kwargs\&quot;: &#123;\&quot;refusal\&quot;: null&#125;, \&quot;response_metadata\&quot;: &#123;\&quot;token_usage\&quot;: &#123;\&quot;completion_tokens\&quot;: 19, \&quot;prompt_tokens\&quot;: 47, \&quot;total_tokens\&quot;: 66, \&quot;completion_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;reasoning_tokens\&quot;: 0&#125;, \&quot;prompt_tokens_details\&quot;: &#123;\&quot;audio_tokens\&quot;: null, \&quot;cached_tokens\&quot;: 0&#125;&#125;, \&quot;model_name\&quot;: \&quot;gpt-3.5-turbo-0125\&quot;, \&quot;system_fingerprint\&quot;: null, \&quot;finish_reason\&quot;: \&quot;stop\&quot;, \&quot;logprobs\&quot;: null&#125;, \&quot;type\&quot;: \&quot;ai\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: \&quot;run-146afcbf-7301-4673-b3d4-0bf6ae2c9191-0\&quot;, \&quot;example\&quot;: false, \&quot;tool_calls\&quot;: [], \&quot;invalid_tool_calls\&quot;: [], \&quot;usage_metadata\&quot;: &#123;\&quot;input_tokens\&quot;: 47, \&quot;output_tokens\&quot;: 19, \&quot;total_tokens\&quot;: 66, \&quot;input_token_details\&quot;: &#123;\&quot;cache_read\&quot;: 0&#125;, \&quot;output_token_details\&quot;: &#123;\&quot;reasoning\&quot;: 0&#125;&#125;&#125;&#125;&quot;</span><br><span class="line">8) &quot;&#123;\&quot;type\&quot;: \&quot;human\&quot;, \&quot;data\&quot;: &#123;\&quot;content\&quot;: \&quot;What does cosine mean?\&quot;, \&quot;additional_kwargs\&quot;: &#123;&#125;, \&quot;response_metadata\&quot;: &#123;&#125;, \&quot;type\&quot;: \&quot;human\&quot;, \&quot;name\&quot;: null, \&quot;id\&quot;: null, \&quot;example\&quot;: false&#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="프로젝트에-Redis-저장-및-로드-코드-추가-1"><a href="#프로젝트에-Redis-저장-및-로드-코드-추가-1" class="headerlink" title="프로젝트에 Redis 저장 및 로드 코드 추가"></a>프로젝트에 Redis 저장 및 로드 코드 추가</h1><p>아래와 같이 Redis 설정을 추가하고</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis 설정</span></span><br><span class="line">redis_client = redis.StrictRedis(</span><br><span class="line">    host=os.getenv(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>),</span><br><span class="line">    port=<span class="built_in">int</span>(os.getenv(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="number">6379</span>)),</span><br><span class="line">    db=<span class="number">0</span>,</span><br><span class="line">    decode_responses=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>대화 히스토리 저장용 함수를 추가하고</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 대화 히스토리 저장용 함수</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_chat_history_to_redis</span>(<span class="params">user_id: <span class="built_in">str</span>, message: <span class="built_in">str</span>, response: <span class="built_in">str</span></span>):</span><br><span class="line">    timestamp = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line">    user_chat_data = &#123;</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: message</span><br><span class="line">    &#125;</span><br><span class="line">    assistant_chat_data = &#123;</span><br><span class="line">        <span class="string">&quot;timestamp&quot;</span>: timestamp,</span><br><span class="line">        <span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: response</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 사용자 메시지와 응답을 각각 저장</span></span><br><span class="line">    redis_client.rpush(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, json.dumps(user_chat_data))</span><br><span class="line">    redis_client.rpush(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, json.dumps(assistant_chat_data))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;대화 내용이 저장되었습니다&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>저장된 히스토리를 불러오는 함수도 추가하였다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_session_history</span>(<span class="params">user_id: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[ChatFormat]:</span><br><span class="line">    <span class="comment"># Redis에서 user_id에 해당하는 대화 내역을 가져오는 로직 작성</span></span><br><span class="line">    history_data = redis_client.lrange(<span class="string">f&quot;chat_history:<span class="subst">&#123;user_id&#125;</span>&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>)</span><br><span class="line">    history = [ChatFormat(**json.loads(item)) <span class="keyword">for</span> item <span class="keyword">in</span> history_data]</span><br><span class="line">    <span class="keyword">return</span> history</span><br></pre></td></tr></table></figure>

<p>그리고 Agent 호출 로직에 history를 load 하여 호출하도록 추가하였다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis에서 사용자 대화 기록 가져와 history 대체하기</span></span><br><span class="line">history = get_session_history(user_id)</span><br><span class="line"></span><br><span class="line"><span class="comment"># GIS AGENT 호출</span></span><br><span class="line">response = call_gis_agent(message, history, summary)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis에 대화 내용 저장</span></span><br><span class="line">save_chat_history_to_redis(user_id, message, response)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 대화 내역 출력 (optional)</span></span><br><span class="line"><span class="built_in">print</span>(print_session_history(history))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>그리고 비슷하게 summary를 저장하는 로직도 추가하였다.</p>
<p>실행하게 되면 Redis에서 아래와 같이 두 가지 Redis key가 사용자 별로 생성된다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;summary_list:default_user&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;chat_history:default_user&quot;</span></span><br></pre></td></tr></table></figure>

<p>한글로 채팅이 오고 가기 때문에 redis에서 조회해도 다 깨져있고, 로그에서 잘 저장되고 불러오는지 확인해보겠다.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">대화 내용이 저장되었습니다</span><br><span class="line">저장된 대화 내용:</span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 효창공원역 맛집 추천해줘</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 효창공원역 주변의 맛집을 추천해드릴게요:</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> <span class="strong">**창성옥**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 새창로 124-10 (용문동 25-16)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-718-2878</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 한식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (소): 27,000원</span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (중): 36,000원</span><br><span class="line"><span class="bullet">     -</span> 해장국: 10,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**영업시간**</span>: 24시간 운영</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**예약 가능 여부**</span>: 가능</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> <span class="strong">**효창동짜장우동**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 백범로 283 (효창동 81-1)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-703-5287</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 중식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 짜장: 4,000원</span><br><span class="line"><span class="bullet">     -</span> 김치우동: 4,000원</span><br><span class="line"><span class="bullet">     -</span> 우동: 4,000원</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> <span class="strong">**박명도봉평메밀막국수**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 원효로 184-1 (원효로2가 43)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-717-7711</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 국수전문</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 들기름막국수: 11,000원</span><br><span class="line"><span class="bullet">     -</span> 물막국수: 11,000원</span><br><span class="line"><span class="bullet">     -</span> 비빔막국수: 11,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**영업시간**</span>: 10:00 - 22:00</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> <span class="strong">**용문해장국**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 효창원로 110 (용문동 8-95)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-712-6290</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 한식</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>: </span><br><span class="line"><span class="bullet">     -</span> 해장국: 7,000원</span><br><span class="line"><span class="bullet">     -</span> 해장국 (2인분): 14,000원</span><br><span class="line"><span class="bullet">     -</span> 뼈전골 (중): 30,000원</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**예약 가능 여부**</span>: 가능, 주차 가능</span><br><span class="line"></span><br><span class="line"><span class="bullet">5.</span> <span class="strong">**아성녹두빈대떡**</span></span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**주소**</span>: 서울특별시 용산구 효창원로48길 3 (용문동 8-113)</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**전화**</span>: 02-706-8238</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**카테고리**</span>: 기타</span><br><span class="line"><span class="bullet">   -</span> <span class="strong">**메뉴**</span>:</span><br><span class="line"><span class="bullet">     -</span> 녹두빈대떡: 15,000원</span><br><span class="line"><span class="bullet">     -</span> 해물파전: 12,000원</span><br><span class="line"><span class="bullet">     -</span> 감자전: 12,000원</span><br><span class="line"></span><br><span class="line"><span class="section">이 맛집들이 효창공원역 근처에서 좋은 선택이 될 것입니다!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집은 반포자이 114동인데, 우리집에서 창성옥까지 얼마나걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 창성옥까지의 소요 시간은 약 24분 30초이며, 거리는 약 12,291 미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 서울역까지 얼마나걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 서울역까지의 소요 시간은 약 33분이며, 거리는 약 9.5킬로미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 아까 알려준 효창공원 맛집 중 첫번째가 어디였지?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 아까 알려드린 효창공원역 맛집 중 첫 번째는 <span class="strong">**창성옥**</span>입니다. 주소는 서울특별시 용산구 새창로 124-10 (용문동 25-16)이고, 전화번호는 02-718-2878입니다. 한식을 제공하며, 뼈전골과 해장국이 주요 메뉴입니다. 24시간 운영하며 예약도 가능합니다.</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 아까 추천해준 효창공원 맛집 중 4번째는 어디였지?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 아까 추천해드린 효창공원역 맛집 중 네 번째는 <span class="strong">**용문해장국**</span>입니다. 주소는 서울특별시 용산구 효창원로 110 (용문동 8-95)이고, 전화번호는 02-712-6290입니다. 한식을 제공하며, 해장국과 뼈전골이 주요 메뉴입니다. 예약이 가능하고 주차도 가능합니다.</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리 부모님집은 도원삼성래미안 아파트야</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 도원삼성래미안 아파트에서 서울역까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 17분 (1074초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 3.965킬로미터 (3965미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전한 운전 되세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 우리부모님집까지 얼마나 걸려</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line"><span class="section">Content: 반포자이 114동에서 도원삼성래미안 아파트까지의 소요 시간은 약 28분이며, 거리는 약 13,026미터입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 광화문 West 빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 광화문 West 빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 29분 (1766초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 9.3킬로미터 (9307미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전한 운전 되세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 판교빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 판교빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 19분 (1144초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 14.47킬로미터 (14470미터)</span><br><span class="line"></span><br><span class="line"><span class="section">안전 운전하세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리집에서 KT 판교빌딩까지 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 반포자이 114동에서 KT 판교빌딩까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간:**</span> 약 19분 17초 (1157초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리:**</span> 약 14,464 미터</span><br><span class="line"></span><br><span class="line"><span class="section">안전 운전하시기 바랍니다!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: user</span><br><span class="line"><span class="section">Content: 우리부모님집에서 KT 대관령 수련관 얼마나 걸려?</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">Role: assistant</span><br><span class="line">Content: 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 안내 결과는 다음과 같습니다:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**소요 시간**</span>: 약 2시간 34분 (9280초)</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**거리**</span>: 약 197.6킬로미터</span><br><span class="line"></span><br><span class="line"><span class="section">이 정보를 바탕으로 여행을 계획하실 수 있습니다. 추가로 도움이 필요하시면 말씀해 주세요!</span></span><br><span class="line"><span class="section">----------</span></span><br><span class="line">None</span><br><span class="line">/Users/leehamin/app/GIS-Agent/gis-ai-agent-be/agent<span class="emphasis">_api/models/chat_</span>models.py:22: LangChainDeprecationWarning: The class <span class="code">`LLMChain`</span> was deprecated in LangChain 0.1.17 and will be removed in 1.0. Use :meth:<span class="code">`~RunnableSequence, e.g., `</span>prompt | llm`` instead.</span><br><span class="line">  chain = LLMChain(prompt=get<span class="emphasis">_summary_</span>prompt<span class="emphasis">_template(), llm=llm)</span></span><br><span class="line"><span class="emphasis">Summary list가 저장되었습니다.</span></span><br><span class="line"><span class="emphasis">answer_</span>data:  &#123;&#x27;answer&#x27;: &#x27;반포자이 114동에서 KT위즈파크까지의 경로 안내는 이미 완료되었습니다. 경로는 반포자이 114동에서 출발하여 신반포로를 따라 남쪽으로 이동한 후, 반포대교를 건너 수원 방향으로 계속 이동하여 경수대로를 따라 KT위즈파크에 도착하는 것입니다. 안전한 여행 되세요!&#x27;, &#x27;chat<span class="emphasis">_status&#x27;: &#x27;C1001&#x27;&#125;</span></span><br><span class="line"><span class="emphasis">answer_</span>summary<span class="emphasis">_list :  [&#x27;사용자가 효창공원역 근처 맛집을 추천받고, 그 중 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 또한, 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, 그리고 KT 판교빌딩까지의 소요 시간과 거리를 문의하여 답변을 받았습니다.&#x27;, &#x27;사용자가 효창공원역 근처 맛집을 추천받고, 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, KT 판교빌딩, 그리고 KT 대관령 수련관까지의 소요 시간과 거리를 문의하여 답변을 받았습니다. 또한, 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 정보를 확인했습니다.&#x27;, &#x27;사용자가 효창공원역 근처 맛집을 추천받고, 그 중 첫 번째와 네 번째 맛집에 대한 정보를 확인했습니다. 또한, 반포자이 114동에서 창성옥, 서울역, 도원삼성래미안 아파트, KT 광화문 West 빌딩, KT 판교빌딩, 그리고 KT 대관령 수련관까지의 소요 시간과 거리를 문의하여 답변을 받았습니다. 사용자는 효창공원역 맛집 추천을 다시 요청했고, 첫 번째와 네 번째 맛집의 정보를 다시 확인했습니다. 도원삼성래미안 아파트에서 KT 대관령 수련관까지의 경로 정보도 확인했으며, 반포자이 114동에서 KT위즈파크까지의 소요 시간과 경로를 안내받았습니다.&#x27;]</span></span><br><span class="line"><span class="emphasis">INFO:     127.0.0.1:51812 - &quot;POST /api/v1/chat HTTP/1.1&quot; 200 OK</span></span><br></pre></td></tr></table></figure>

<p>위와 같이 대화 내용과 summary_list가 모두 잘 저장되고 load되며 멀티턴 또한 잘 진행된다.</p>
<h1 id="User-별로-대화가-저장되도록-user-uuid-적용-1"><a href="#User-별로-대화가-저장되도록-user-uuid-적용-1" class="headerlink" title="User 별로 대화가 저장되도록 user_uuid 적용"></a>User 별로 대화가 저장되도록 user_uuid 적용</h1><p>더미로 default_user라는 user_id로 통일하던 것을<br>유저별로 대화 history와 summary가 적용될 수 있도록, 식별자인 user_uuid를 적용하였다.</p>
<p>헤더에 X-User-UUID를 달고 가는 방식이다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_or_get_uuid</span>(<span class="params">user_uuid: <span class="type">Optional</span>[<span class="built_in">str</span>]</span>) -&gt; UUID:</span><br><span class="line">    <span class="keyword">if</span> user_uuid:</span><br><span class="line">        <span class="keyword">try</span>: <span class="comment"># UUID가 유효한지 검사</span></span><br><span class="line">            <span class="keyword">return</span> UUID(user_uuid)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            raise_error(<span class="string">&quot;E1006&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># UUID가 없으면 새 UUID 생성</span></span><br><span class="line">        <span class="keyword">return</span> uuid4()</span><br></pre></td></tr></table></figure>

<p>유저 아이디에 맞게 redis key가 생성된다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;summary_list:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;summary_list:default_user&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;chat_history:default_user&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-세션1-1"><a href="#테스트-세션1-1" class="headerlink" title="테스트 세션1"></a>테스트 세션1</h2><h3 id="Request-8"><a href="#Request-8" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;우리집은 판교 그랑블 아파트야, 우리집 좌표 알고 있니?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-8"><a href="#Response-8" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;네, 판교 그랑블 아파트의 좌표는 다음과 같습니다:\n- 위도: 37.3933\n- 경도: 127.1144\n\n더 필요한 정보가 있으면 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-세션2-1"><a href="#테스트-세션2-1" class="headerlink" title="테스트 세션2"></a>테스트 세션2</h2><h3 id="Request-9"><a href="#Request-9" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;효창공원 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-9"><a href="#Response-9" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;효창공원 주변의 맛집 정보는 다음과 같습니다:\n\n1. **효창원**  \n   - **주소**: 서울 용산구 효창원로 97\n   - **특징**: 전통 한식과 다양한 메뉴를 제공하는 식당입니다.\n\n2. **카페 드 파리**  \n   - **주소**: 서울 용산구 효창원로 85\n   - **특징**: 디저트와 커피를 전문으로 하는 아늑한 카페입니다.\n\n3. **고기리 막창**  \n   - **주소**: 서울 용산구 효창원로 95\n   - **특징**: 고기 요리를 전문으로 하는 맛집으로, 막창이 유명합니다.\n\n이 외에도 더 많은 맛집이 있으니, 필요하시면 추가 정보를 요청해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션3-1"><a href="#테스트-세션3-1" class="headerlink" title="테스트 세션3"></a>테스트 세션3</h2><h3 id="Request-10"><a href="#Request-10" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;첫번째 것으로 할래! 우리집에서 거기까지 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-10"><a href="#Response-10" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원까지의 소요 시간은 약 49분입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션4-1"><a href="#테스트-세션4-1" class="headerlink" title="테스트 세션4"></a>테스트 세션4</h2><h3 id="Request-11"><a href="#Request-11" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그럼 집에서 출발해서 거기서 밥먹고, 김포공항 가면 얼마나 걸릴까?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-11"><a href="#Response-11" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원으로 이동한 후, 효창원에서 김포공항까지 이동하는 데 걸리는 총 소요 시간은 다음과 같습니다:\n\n- **판교 그랑블 아파트 → 효창원**: 약 41분 38초\n- **효창원 → 김포공항**: 약 56분 4초\n\n따라서, 총 소요 시간은 약 1시간 37분 42초입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="테스트-세션5-1"><a href="#테스트-세션5-1" class="headerlink" title="테스트 세션5"></a>테스트 세션5</h2><h3 id="Request-12"><a href="#Request-12" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그러면 김포공항 대신 인천공항으로 가면 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Response-12"><a href="#Response-12" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 효창원까지의 소요 시간은 약 1시간 10분이며, 효창원에서 인천공항까지의 소요 시간은 약 47분입니다. 따라서, 총 소요 시간은 약 1시간 57분입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 더 필요한 정보가 있는지 묻습니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 자신의 집이 판교 그랑블 아파트라고 말하며, 집의 좌표를 알고 있는지 물어봅니다. 어시스턴트는 위도 37.3933, 경도 127.1144의 좌표를 제공합니다. 사용자가 효창공원 맛집을 추천해달라고 하자, 어시스턴트는 효창원, 카페 드 파리, 고기리 막창 등의 맛집 정보를 제공합니다. 사용자가 효창원을 선택하며, 집에서 그곳까지 얼마나 걸리는지 물어보자, 어시스턴트는 약 49분이 걸린다고 답변합니다. 사용자가 효창원에서 식사를 마치고 김포공항으로 가는 시간을 묻자, 어시스턴트는 판교 그랑블 아파트에서 효창원까지 약 41분 38초, 효창원에서 김포공항까지 약 56분 4초로 총 소요 시간이 약 1시간 37분 42초라고 안내합니다. 사용자가 인천공항으로 가는 시간을 묻자, 어시스턴트는 총 소요 시간이 약 1시간 57분이라고 안내합니다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="서버에-배포-1"><a href="#서버에-배포-1" class="headerlink" title="서버에 배포"></a>서버에 배포</h1><p>프로젝트에서 requirements.txt 파일을 사용하고 있기 때문에, 이 파일에 redis 패키지를 추가했다.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis</span><br></pre></td></tr></table></figure>

<p>Redis가 실행되고 있는 호스트의 IP로 바꾸었다</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># host=os.getenv(&#x27;REDIS_HOST&#x27;, &#x27;localhost&#x27;),</span></span><br><span class="line">host=os.getenv(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;10.71.176.93&#x27;</span>),</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EC2 환경</span></span><br><span class="line">redis_url = os.getenv(<span class="string">&quot;REDIS_URL&quot;</span>, <span class="string">&quot;redis://10.71.176.93:6379/0&quot;</span>)</span><br><span class="line"><span class="comment"># 로컬 환경</span></span><br><span class="line"><span class="comment"># redis_url = os.getenv(&quot;REDIS_URL&quot;, &quot;redis://localhost:6379/0&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-서버가-외부-연결을-허용하는지-확인-1"><a href="#Redis-서버가-외부-연결을-허용하는지-확인-1" class="headerlink" title="Redis 서버가 외부 연결을 허용하는지 확인"></a>Redis 서버가 외부 연결을 허용하는지 확인</h2><h3 id="Redis-설정파일-위치-확인-1"><a href="#Redis-설정파일-위치-확인-1" class="headerlink" title="Redis 설정파일 위치 확인"></a>Redis 설정파일 위치 확인</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 설정 파일 위치 확인</span></span><br><span class="line">find / -name &quot;redis.conf&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Redis-설정-파일-수정-1"><a href="#Redis-설정-파일-수정-1" class="headerlink" title="Redis 설정 파일 수정"></a>Redis 설정 파일 수정</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">이렇게 있던 것을</span></span><br><span class="line">bind 127.0.0.1 -::1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">이렇게</span></span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>

<h3 id="Redis-재시작-1"><a href="#Redis-재시작-1" class="headerlink" title="Redis 재시작"></a>Redis 재시작</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 서버의 프로세스 ID 확인</span></span><br><span class="line">ps aux | grep redis-server</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">프로세스 ID를 이용해 종료 (예: PID가 1234인 경우)</span></span><br><span class="line">kill 1234</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis 서버 재시작</span></span><br><span class="line">redis-server /path/to/redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="여전히-protected-mode가-실행중으로-나타난다-1"><a href="#여전히-protected-mode가-실행중으로-나타난다-1" class="headerlink" title="여전히 protected mode가 실행중으로 나타난다"></a>여전히 protected mode가 실행중으로 나타난다</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# curl -v telnet://10.71.176.93:6379</span><br><span class="line">*   Trying 10.71.176.93:6379...</span><br><span class="line">* Connected to 10.71.176.93 (10.71.176.93) port 6379</span><br><span class="line">-DENIED Redis is running in protected mode because protected mode is enabled and no password is set for the default user. In this mode connections are only accepted from the loopback interface. If you want to connect from external computers to Redis you may adopt one of the following solutions: 1) Just disable protected mode sending the command &#x27;CONFIG SET protected-mode no&#x27; from the loopback interface by connecting to Redis from the same host the server is running, however MAKE SURE Redis is not publicly accessible from internet if you do so. Use CONFIG REWRITE to make this change permanent. 2) Alternatively you can just disable the protected mode by editing the Redis configuration file, and setting the protected mode option to &#x27;no&#x27;, and then restarting the server. 3) If you started the server manually just for testing, restart it with the &#x27;--protected-mode no&#x27; option. 4) Set up an authentication password for the default user. NOTE:You only need to do one of the above things in order for the server to start accepting connections from the outside.</span><br></pre></td></tr></table></figure>

<ul>
<li>Redis CLI를 통해 임시로 protected-mode 비활성화<br>Redis 서버에 접근 가능한 경우, Redis CLI를 사용하여 protected-mode를 비활성화할 수 있다.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Redis CLI 접속</span></span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">protected-mode 비활성화</span></span><br><span class="line">CONFIG SET protected-mode no</span><br><span class="line"></span><br><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# curl -v telnet://10.71.176.93:6379</span><br><span class="line">*   Trying 10.71.176.93:6379...</span><br><span class="line">* Connected to 10.71.176.93 (10.71.176.93) port 6379</span><br></pre></td></tr></table></figure>

<p>이번엔 연결이 되는 것 같다</p>
<h1 id="서버-테스트-1"><a href="#서버-테스트-1" class="headerlink" title="서버 테스트"></a>서버 테스트</h1><h2 id="테스트-1-1"><a href="#테스트-1-1" class="headerlink" title="테스트 1"></a>테스트 1</h2><h3 id="Request-13"><a href="#Request-13" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;우리집은 판교 그랑블 아파트야, 우리집 좌표 알고 있니?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-13"><a href="#Response-13" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트의 좌표는 다음과 같습니다:\n\n- **위도**: 37.393299557105\n- **경도**: 127.11436915566647\n\n이 정보가 도움이 되길 바랍니다! 추가적인 질문이 있으면 언제든지 말씀해 주세요.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-2-1"><a href="#테스트-2-1" class="headerlink" title="테스트 2"></a>테스트 2</h2><h3 id="Request-14"><a href="#Request-14" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;포천 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-14"><a href="#Response-14" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;포천의 맛집 정보를 제공해드렸습니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-3-1"><a href="#테스트-3-1" class="headerlink" title="테스트 3"></a>테스트 3</h2><h3 id="Request-15"><a href="#Request-15" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;영종도 맛집 알려줘&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-15"><a href="#Response-15" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;영종도에서 추천하는 맛집 목록입니다:\n\n1. **선녀풍**\n   - 주소: 인천광역시 중구 을왕동 용유서로 272, 689-1\n   - 전화: 032-751-2121\n   - 주메뉴: 해물파전(15,000원), 선녀물회(20,000원), 낙지물회(28,000원)\n   - 영업시간: 매일 12:00 - 22:00\n   - 주차: 가능\n   - 좌표: [37.4444, 126.3787]\n\n2. **황해해물칼국수**\n   - 주소: 인천광역시 중구 덕교동 마시란로 37, 128-56\n   - 전화: 032-752-3017\n   - 주메뉴: 산낙지(15,000원), 전복 (4마리)(16,000원), 해물칼국수(10,000원)\n   - 영업시간: 매일 10:00 - 20:00\n   - 주차: 가능\n   - 좌표: [37.4262, 126.4212]\n\n3. **동해막국수**\n   - 주소: 인천광역시 중구 을왕동 용유서로479번길 16, 859-3\n   - 전화: 032-746-5522\n   - 영업시간: 매일 11:00 - 21:00\n   - 주차: 가능\n   - 좌표: [37.4616, 126.3705]\n\n4. **미애네칼국수**\n   - 주소: 인천광역시 중구 덕교동 용유로21번길 51, 80-14\n   - 전화: 032-746-3838\n   - 주메뉴: 산낙지(18,000원), 전복회(15,000원), 바다속칼국수 (소)(35,000원)\n   - 영업시간: 매일 09:00 - 21:00\n   - 주차: 가능\n   - 좌표: [37.4300, 126.4242]\n\n5. **을항**\n   - 주소: 인천광역시 중구 을왕동 선녀바위로55번길 39, 686-5\n   - 전화: 032-752-2227\n   - 주메뉴: 물회(1인)(25,000원), 물회(대)(75,000원), 물회(중)(55,000원)\n   - 좌표: [37.4436, 126.3782]\n\n맛집 선택에 도움이 되길 바랍니다!&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-4"><a href="#테스트-4" class="headerlink" title="테스트 4"></a>테스트 4</h2><h3 id="Request-16"><a href="#Request-16" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;세번째 것으로 할래! 우리집에서 거기까지 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-16"><a href="#Response-16" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 영종도의 세 번째 맛집인 동해막국수까지의 경로는 약 1시간 5분이 소요되며, 거리는 약 78.54 km입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-5"><a href="#테스트-5" class="headerlink" title="테스트 5"></a>테스트 5</h2><h3 id="Request-17"><a href="#Request-17" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그럼 집에서 출발해서 거기서 밥먹고, 김포공항 가면 얼마나 걸릴까?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-17"><a href="#Response-17" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 출발하여 동해막국수에서 식사를 하고, 김포국제공항까지 가는 전체 경로는 다음과 같습니다:\n\n1. **판교 그랑블 아파트 → 동해막국수 (인천)**\n   - 소요 시간: 약 1시간 5분\n   - 거리: 약 78.54 km\n\n2. **동해막국수 (인천) → 김포국제공항**\n   - 소요 시간: 약 40분\n   - 거리: 약 45.51 km\n\n따라서 전체 소요 시간은 약 1시간 45분이며, 총 거리는 약 124.05 km입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포국제공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-6"><a href="#테스트-6" class="headerlink" title="테스트 6"></a>테스트 6</h2><h3 id="Request-18"><a href="#Request-18" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그러면 김포공항 대신 인천공항으로 가면 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Request-19"><a href="#Request-19" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 출발하여 동해막국수에서 식사를 하고, 인천국제공항까지 가는 전체 경로는 다음과 같습니다:\n\n1. **판교 그랑블 아파트 → 동해막국수 (인천)**\n   - 소요 시간: 약 1시간 5분\n   - 거리: 약 78.54 km\n\n2. **동해막국수 (인천) → 인천국제공항**\n   - 소요 시간: 약 19분\n   - 거리: 약 13.88 km\n\n따라서 전체 소요 시간은 약 1시간 24분이며, 총 거리는 약 92.42 km입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포국제공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트, 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다. 마지막으로 사용자가 인천공항으로 가는 경로를 묻자, AI가 소요 시간과 거리를 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis에서도-해당-사용자-id에-맞게-history와-summary가-잘-저장된다"><a href="#Redis에서도-해당-사용자-id에-맞게-history와-summary가-잘-저장된다" class="headerlink" title="Redis에서도 해당 사용자 id에 맞게 history와 summary가 잘 저장된다."></a>Redis에서도 해당 사용자 id에 맞게 history와 summary가 잘 저장된다.</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;summary_list:b4d4e144-b8af-47d9-953b-ca80e65a474b&quot;</span><br><span class="line">2) &quot;chat_history:b4d4e144-b8af-47d9-953b-ca80e65a474b&quot;</span><br><span class="line">3) &quot;chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span><br><span class="line">4) &quot;summary_list:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;timestamp\&quot;: \&quot;2024-11-11 08:36:48\&quot;, \&quot;role\&quot;: \&quot;user\&quot;, \&quot;content\&quot;: \&quot;\\uc6b0\\ub9ac\\uc9d1\\uc740 \\ud310\\uad50 \\uadf8\\ub791\\ube14 \\uc544\\ud30c\\ud2b8\\uc57c, \\uc6b0\\ub9ac\\uc9d1 \\uc88c\\ud45c \\uc54c\\uace0 \\uc788\\ub2c8?\&quot;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;timestamp\&quot;: \&quot;2024-11-11 08:36:48\&quot;, \&quot;role\&quot;: \&quot;assistant\&quot;, \&quot;content\&quot;: \&quot;\\ud310\\uad50 \\uadf8\\ub791\\ube14 \\uc544\\ud30c\\ud2b8\\uc758 \\uc88c\\ud45c\\ub294 \\ub2e4\\uc74c\\uacfc \\uac19\\uc2b5\\ub2c8\\ub2e4:\\n\\n- **\\uc704\\ub3c4**: 37.393299557105\\n- **\\uacbd\\ub3c4**: 127.11436915566647\\n\\n\\uc774 \\uc815\\ubcf4\\uac00 \\ub3c4\\uc6c0\\uc774 \\ub418\\uae38 \\ubc14\\ub78d\\ub2c8\\ub2e4! \\ucd94\\uac00\\uc801\\uc778 \\uc9c8\\ubb38\\uc774 \\uc788\\uc73c\\uba74 \\uc5b8\\uc81c\\ub4e0\\uc9c0 \\ub9d0\\uc500\\ud574 \\uc8fc\\uc138\\uc694.\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 테스트 4</span><br><span class="line"></span><br><span class="line">### Request</span><br><span class="line">~~~json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;chat&quot;: &#123;</span><br><span class="line">    &quot;message&quot;: &quot;세번째 것으로 할래! 우리집에서 거기까지 얼마나 걸려?&quot;,</span><br><span class="line">    &quot;history&quot;: []</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;summary_list&quot;:[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Response-18"><a href="#Response-18" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 영종도의 세 번째 맛집인 동해막국수까지의 경로는 약 1시간 5분이 소요되며, 거리는 약 78.54 km입니다. 추가로 궁금한 점이 있으면 언제든지 말씀해 주세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-5-1"><a href="#테스트-5-1" class="headerlink" title="테스트 5"></a>테스트 5</h2><h3 id="Request-20"><a href="#Request-20" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그럼 집에서 출발해서 거기서 밥먹고, 김포공항 가면 얼마나 걸릴까?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Response-19"><a href="#Response-19" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 출발하여 동해막국수에서 식사를 하고, 김포국제공항까지 가는 전체 경로는 다음과 같습니다:\n\n1. **판교 그랑블 아파트 → 동해막국수 (인천)**\n   - 소요 시간: 약 1시간 5분\n   - 거리: 약 78.54 km\n\n2. **동해막국수 (인천) → 김포국제공항**\n   - 소요 시간: 약 40분\n   - 거리: 약 45.51 km\n\n따라서 전체 소요 시간은 약 1시간 45분이며, 총 거리는 약 124.05 km입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포국제공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="테스트-6-1"><a href="#테스트-6-1" class="headerlink" title="테스트 6"></a>테스트 6</h2><h3 id="Request-21"><a href="#Request-21" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;그러면 김포공항 대신 인천공항으로 가면 얼마나 걸려?&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;history&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Request-22"><a href="#Request-22" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;chat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;answer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;판교 그랑블 아파트에서 출발하여 동해막국수에서 식사를 하고, 인천국제공항까지 가는 전체 경로는 다음과 같습니다:\n\n1. **판교 그랑블 아파트 → 동해막국수 (인천)**\n   - 소요 시간: 약 1시간 5분\n   - 거리: 약 78.54 km\n\n2. **동해막국수 (인천) → 인천국제공항**\n   - 소요 시간: 약 19분\n   - 거리: 약 13.88 km\n\n따라서 전체 소요 시간은 약 1시간 24분이며, 총 거리는 약 92.42 km입니다. 안전하고 즐거운 여행 되세요!&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;chat_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;C1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;summary_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;S1001&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;summary_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트에 대해 묻자, AI가 아파트의 좌표를 제공하며 도움이 되길 바란다고 답변했다. 사용자가 포천 맛집을 묻자, AI가 포천의 맛집 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 영종도 맛집을 묻자, AI는 영종도에서 추천하는 다양한 맛집 목록과 상세 정보를 제공하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트와 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한, 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포국제공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;사용자가 판교 그랑블 아파트, 포천 및 영종도의 맛집에 대해 묻자, AI가 각각의 좌표와 맛집 정보를 제공하며 도움이 되길 바란다고 답변했다. 이후 사용자가 자신의 집인 판교 그랑블 아파트의 좌표를 알고 있는지 묻자, AI는 정확한 좌표를 제공하였다. 또한 사용자가 영종도의 맛집 중 세 번째 맛집인 동해막국수에 가고 싶다고 하자, AI는 판교 그랑블 아파트에서 해당 맛집까지의 소요 시간과 거리를 안내하였다. 이어서 사용자가 동해막국수에서 식사를 하고 김포공항까지의 경로를 묻자, AI는 전체 소요 시간과 거리를 상세히 안내하였다. 마지막으로 사용자가 인천공항으로 가는 경로를 묻자, AI가 소요 시간과 거리를 안내하였다.&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis에서도-해당-사용자-id에-맞게-history와-summary가-잘-저장된다-1"><a href="#Redis에서도-해당-사용자-id에-맞게-history와-summary가-잘-저장된다-1" class="headerlink" title="Redis에서도 해당 사용자 id에 맞게 history와 summary가 잘 저장된다."></a>Redis에서도 해당 사용자 id에 맞게 history와 summary가 잘 저장된다.</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ec2-ct01-dev-slm-app-01 ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;summary_list:b4d4e144-b8af-47d9-953b-ca80e65a474b&quot;</span><br><span class="line">2) &quot;chat_history:b4d4e144-b8af-47d9-953b-ca80e65a474b&quot;</span><br><span class="line">3) &quot;chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span><br><span class="line">4) &quot;summary_list:6b622f61-fd80-4906-bc50-e9aee6c72e77&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange chat_history:6b622f61-fd80-4906-bc50-e9aee6c72e77 0 -1</span><br><span class="line">1) &quot;&#123;\&quot;timestamp\&quot;: \&quot;2024-11-11 08:36:48\&quot;, \&quot;role\&quot;: \&quot;user\&quot;, \&quot;content\&quot;: \&quot;\\uc6b0\\ub9ac\\uc9d1\\uc740 \\ud310\\uad50 \\uadf8\\ub791\\ube14 \\uc544\\ud30c\\ud2b8\\uc57c, \\uc6b0\\ub9ac\\uc9d1 \\uc88c\\ud45c \\uc54c\\uace0 \\uc788\\ub2c8?\&quot;&#125;&quot;</span><br><span class="line">2) &quot;&#123;\&quot;timestamp\&quot;: \&quot;2024-11-11 08:36:48\&quot;, \&quot;role\&quot;: \&quot;assistant\&quot;, \&quot;content\&quot;: \&quot;\\ud310\\uad50 \\uadf8\\ub791\\ube14 \\uc544\\ud30c\\ud2b8\\uc758 \\uc88c\\ud45c\\ub294 \\ub2e4\\uc74c\\uacfc \\uac19\\uc2b5\\ub2c8\\ub2e4:\\n\\n- **\\uc704\\ub3c4**: 37.393299557105\\n- **\\uacbd\\ub3c4**: 127.11436915566647\\n\\n\\uc774 \\uc815\\ubcf4\\uac00 \\ub3c4\\uc6c0\\uc774 \\ub418\\uae38 \\ubc14\\ub78d\\ub2c8\\ub2e4! \\ucd94\\uac00\\uc801\\uc778 \\uc9c8\\ubb38\\uc774 \\uc788\\uc73c\\uba74 \\uc5b8\\uc81c\\ub4e0\\uc9c0 \\ub9d0\\uc500\\ud574 \\uc8fc\\uc138\\uc694.\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>LangChain의 RunnableWithMessage와 Redis 활용하여 대화내용 저장하기</p><p><a href="https://hamin7.github.io/2024/11/03/LangChain-RunnableWithMessage/">https://hamin7.github.io/2024/11/03/LangChain-RunnableWithMessage/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>hamin</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-11-03</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2025-01-21</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/LangChain/">LangChain</a><a class="link-muted mr-2" rel="tag" href="/tags/LLM/">LLM</a><a class="link-muted mr-2" rel="tag" href="/tags/Redis/">Redis</a><a class="link-muted mr-2" rel="tag" href="/tags/LLM-LangChain/">LLM,LangChain</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/11/05/SK-AI-SUMMIT-2024/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SK AI SUMMIT 2024 후기</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/11/03/LangChain-Memory-1/"><span class="level-item">멀티턴, 대화 요약를 위한 DB 설계</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.gif" alt="kahlua"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">kahlua</p><p class="is-size-6 is-block">kahlua&#039;s memos</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Seoul</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">66</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">66</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">47</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">15</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/DeepLearning/"><span class="level-start"><span class="level-item">DeepLearning</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/JupyterLab/"><span class="level-start"><span class="level-item">JupyterLab</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/MachineLearning/"><span class="level-start"><span class="level-item">MachineLearning</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/AI/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Projects/Backend/"><span class="level-start"><span class="level-item">Backend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Projects/Backend/Django/"><span class="level-start"><span class="level-item">Django</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Projects/Backend/Django/SKT/"><span class="level-start"><span class="level-item">SKT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Projects/Backend/Django/SKT/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Projects/Backend/Django/SKT/AWS/Lambda/"><span class="level-start"><span class="level-item">Lambda</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/AI/Toy-Project/"><span class="level-start"><span class="level-item">Toy Project</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/"><span class="level-start"><span class="level-item">Backend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/Node-js/"><span class="level-start"><span class="level-item">Node.js</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/Node-js/Frontend/"><span class="level-start"><span class="level-item">Frontend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/Node-js/Frontend/SKT/"><span class="level-start"><span class="level-item">SKT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/Node-js/Frontend/SKT/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/AI/Toy-Project/Projects/Backend/Node-js/Frontend/SKT/AWS/EC2/"><span class="level-start"><span class="level-item">EC2</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">15</span></span></a><ul><li><a class="level is-mobile" href="/categories/AWS/API-Gateway/"><span class="level-start"><span class="level-item">API Gateway</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/Aurora/"><span class="level-start"><span class="level-item">Aurora</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/Cognito/"><span class="level-start"><span class="level-item">Cognito</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/EC2/"><span class="level-start"><span class="level-item">EC2</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/EKS/"><span class="level-start"><span class="level-item">EKS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/Lambda/"><span class="level-start"><span class="level-item">Lambda</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/Route53/"><span class="level-start"><span class="level-item">Route53</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/AWS/SageMaker/"><span class="level-start"><span class="level-item">SageMaker</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Agent/"><span class="level-start"><span class="level-item">Agent</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Agent/Document/"><span class="level-start"><span class="level-item">Document</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Backend/"><span class="level-start"><span class="level-item">Backend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Backend/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Batch-Server/"><span class="level-start"><span class="level-item">Batch Server</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Book-Review/"><span class="level-start"><span class="level-item">Book Review</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Cron/"><span class="level-start"><span class="level-item">Cron</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Docker/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Framework/"><span class="level-start"><span class="level-item">Framework</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Framework/Python/"><span class="level-start"><span class="level-item">Python</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Javascript/"><span class="level-start"><span class="level-item">Javascript</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Javascript/Node-js/"><span class="level-start"><span class="level-item">Node.js</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/LLM/"><span class="level-start"><span class="level-item">LLM</span></span><span class="level-end"><span class="level-item tag">5</span></span></a><ul><li><a class="level is-mobile" href="/categories/LLM/BERT/"><span class="level-start"><span class="level-item">BERT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/LLM/LangChain/"><span class="level-start"><span class="level-item">LangChain</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/LLM/LangSmith/"><span class="level-start"><span class="level-item">LangSmith</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/CLI/"><span class="level-start"><span class="level-item">CLI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/LiteLLM/"><span class="level-start"><span class="level-item">LiteLLM</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Machine-Learning/Autonomous-Vehicles/"><span class="level-start"><span class="level-item">Autonomous Vehicles</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Microsoft/"><span class="level-start"><span class="level-item">Microsoft</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Microsoft/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Netflix/"><span class="level-start"><span class="level-item">Netflix</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Philosophy/"><span class="level-start"><span class="level-item">Philosophy</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Philosophy/Bioethics/"><span class="level-start"><span class="level-item">Bioethics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Projects/"><span class="level-start"><span class="level-item">Projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/"><span class="level-start"><span class="level-item">Backend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/"><span class="level-start"><span class="level-item">Frontend</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/"><span class="level-start"><span class="level-item">React.js</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/AWS/Lambda/"><span class="level-start"><span class="level-item">Lambda</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/AWS/Lambda/Toy-Projects/"><span class="level-start"><span class="level-item">Toy Projects</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/AWS/Lambda/Toy-Projects/Firebase/"><span class="level-start"><span class="level-item">Firebase</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Projects/Backend/Frontend/React-js/AWS/Lambda/Toy-Projects/Firebase/KT/"><span class="level-start"><span class="level-item">KT</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/Travel/"><span class="level-start"><span class="level-item">Travel</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/Travel/Japan/"><span class="level-start"><span class="level-item">Japan</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-28T06:47:55.000Z">2025-01-28</time></p><p class="title"><a href="/2025/01/28/Azure-EventHub/">Azure-EventHub</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-21T13:21:15.000Z">2025-01-21</time></p><p class="title"><a href="/2025/01/21/Azure-API-Management-Deploy/">Azure-API-Management-Deploy</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-14T12:49:06.000Z">2025-01-14</time></p><p class="title"><a href="/2025/01/14/Azure-API-Management/">Azure-API-Management</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2025-01-07T10:43:18.000Z">2025-01-07</time></p><p class="title"><a href="/2025/01/07/Azure-WebApp-Sample-Deploy/">Azure WebApp(App Service)으로 API 배포하기</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-19T13:01:35.000Z">2024-12-19</time></p><p class="title"><a href="/2024/12/19/Azure-AZ104/">Azure-AZ104</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/01/"><span class="level-start"><span class="level-item">January 2025</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/11/"><span class="level-start"><span class="level-item">November 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">April 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AWS/"><span class="tag">AWS</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AZ104/"><span class="tag">AZ104</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AZ204/"><span class="tag">AZ204</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Agent/"><span class="tag">Agent</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Azure/"><span class="tag">Azure</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BERT/"><span class="tag">BERT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Backend/"><span class="tag">Backend</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Batch-Server/"><span class="tag">Batch Server</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Biotechnology/"><span class="tag">Biotechnology</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blog/"><span class="tag">Blog</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Books/"><span class="tag">Books</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CLI/"><span class="tag">CLI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cron/"><span class="tag">Cron</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Deep-Learning/"><span class="tag">Deep Learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DeepLearning/"><span class="tag">DeepLearning</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Django/"><span class="tag">Django</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Ethics/"><span class="tag">Ethics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Firebase/"><span class="tag">Firebase</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Frontend/"><span class="tag">Frontend</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GPU/"><span class="tag">GPU</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Javascript/"><span class="tag">Javascript</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JupyterLab/"><span class="tag">JupyterLab</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLM/"><span class="tag">LLM</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LLM-LangChain/"><span class="tag">LLM,LangChain</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LangChain/"><span class="tag">LangChain</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LangSmith/"><span class="tag">LangSmith</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LiteLLM/"><span class="tag">LiteLLM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MS-Azure/"><span class="tag">MS Azure</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MachineLearning/"><span class="tag">MachineLearning</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Microsoft/"><span class="tag">Microsoft</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Microsoft-Azure/"><span class="tag">Microsoft,Azure</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NLP/"><span class="tag">NLP</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Netflix/"><span class="tag">Netflix</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Node-js/"><span class="tag">Node.js</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React/"><span class="tag">React</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/React-js/"><span class="tag">React.js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redux/"><span class="tag">Redux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SK/"><span class="tag">SK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Self-Driving-Cars/"><span class="tag">Self-Driving Cars</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Travel/"><span class="tag">Travel</span><span class="tag">2</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar.png" alt="Kahlua" height="28"></a><p class="is-size-7"><span>&copy; 2025 hamin</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>